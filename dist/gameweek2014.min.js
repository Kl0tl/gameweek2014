require=function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(){}var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.on=c,d.once=c,d.off=c,d.emit=c,d.binding=function(){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(){throw new Error("process.chdir is not supported")}},{}],2:[function(a,b,c){(function(a){function b(a,b){for(var c=0,d=a.length-1;d>=0;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}function d(a,b){if(a.filter)return a.filter(b);for(var c=[],d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,f=function(a){return e.exec(a).slice(1)};c.resolve=function(){for(var c="",e=!1,f=arguments.length-1;f>=-1&&!e;f--){var g=f>=0?arguments[f]:a.cwd();if("string"!=typeof g)throw new TypeError("Arguments to path.resolve must be strings");g&&(c=g+"/"+c,e="/"===g.charAt(0))}return c=b(d(c.split("/"),function(a){return!!a}),!e).join("/"),(e?"/":"")+c||"."},c.normalize=function(a){var e=c.isAbsolute(a),f="/"===g(a,-1);return a=b(d(a.split("/"),function(a){return!!a}),!e).join("/"),a||e||(a="."),a&&f&&(a+="/"),(e?"/":"")+a},c.isAbsolute=function(a){return"/"===a.charAt(0)},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(d(a,function(a){if("string"!=typeof a)throw new TypeError("Arguments to path.join must be strings");return a}).join("/"))},c.relative=function(a,b){function d(a){for(var b=0;b<a.length&&""===a[b];b++);for(var c=a.length-1;c>=0&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=c.resolve(a).substr(1),b=c.resolve(b).substr(1);for(var e=d(a.split("/")),f=d(b.split("/")),g=Math.min(e.length,f.length),h=g,i=0;g>i;i++)if(e[i]!==f[i]){h=i;break}for(var j=[],i=h;i<e.length;i++)j.push("..");return j=j.concat(f.slice(h)),j.join("/")},c.sep="/",c.delimiter=":",c.dirname=function(a){var b=f(a),c=b[0],d=b[1];return c||d?(d&&(d=d.substr(0,d.length-1)),c+d):"."},c.basename=function(a,b){var c=f(a)[2];return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return f(a)[3]};var g="b"==="ab".substr(-1)?function(a,b,c){return a.substr(b,c)}:function(a,b,c){return 0>b&&(b=a.length+b),a.substr(b,c)}}).call(this,a("/Users/adriencarta/gameweek2014/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"/Users/adriencarta/gameweek2014/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":1}],game:[function(a,b){b.exports=a("HPsMKw")},{}],HPsMKw:[function(a,b,c){"use strict";var d,e,f;d=a("./loaders").AssetsLoader,e=a("./loaders").ImagesLoader,f=a("./loaders").JsonLoader,c.loader=new d("/assets").when(/\.(?:png|jpg)$/,new e).when(/\.json$/,new f)},{"./loaders":9}],5:[function(a){"use strict";var b,c,d,e;b=a("game"),c=a("./nuclear_modules/game.transform"),d=a("./nuclear_modules/game.rendering"),e=a("./nuclear_modules/game.animations"),a("./nuclear_modules/game.inputs/"),a("./nuclear_modules/game.roguemap/"),nuclear.module("inputs").config("gamepad").FACE_1="FIRE";var f=nuclear.entity.create();nuclear.component("inputs").add(f,{FIRE:function(a,b){0!==b&&console.log(b)},UP:function(a,b){0!==b&&console.log(b)}});var g=nuclear.system.context();g.dests=[document.getElementById("bottom-buffer").getContext("2d"),document.getElementById("dynamic-buffer").getContext("2d"),document.getElementById("top-buffer").getContext("2d"),document.getElementById("main").getContext("2d")],g.WIDTH=g.dests[2].canvas.width,g.HEIGHT=g.dests[2].canvas.height,b.loader.load(["atlases/prinny.atlas.png","atlases/prinny.atlas.json","animations/prinny/prinny@dancing.json","atlases/stone.atlas.png","atlases/stone.atlas.json"]).error(function(a){throw a}).done(function(){nuclear.import([c,d,e]),console.log("modules loaded!"),nuclear.entity("map").create({mapData:{width:40,height:40,roomWidth:[3,20],roomHeight:[3,20]}}),window.requestAnimationFrame(function a(){window.requestAnimationFrame(a),nuclear.system.run()})}).progress(console.log.bind(console,"bundle progress"))},{"./nuclear_modules/game.animations":12,"./nuclear_modules/game.inputs/":14,"./nuclear_modules/game.rendering":19,"./nuclear_modules/game.roguemap/":22,"./nuclear_modules/game.transform":27,game:"HPsMKw"}],6:[function(a,b){"use strict";function c(a){function b(a){return function(){var b,d;for(b=0;d=a[b];b+=1)d.apply(c,arguments)}}var c;c=this,c.assets=[],c._loadListeners=[],c._errorListeners=[],c._progressListeners=[],a.call(this,b(c._loadListeners),b(c._errorListeners),b(c._progressListeners))}c.prototype.done=function(a){return this._loadListeners.push(a),this},c.prototype.error=function(a){return this._errorListeners.push(a),this},c.prototype.progress=function(a){return this._progressListeners.push(a),this},b.exports=c},{}],7:[function(a,b){"use strict";function c(a){this.basePath=a||"/",this.cache=Object.create(null),this.rules=[]}var d,e;d=a("./assets-bundle"),e=a("path"),c.prototype.get=function(a){return this.cache[a]},c.prototype.has=function(a){return a in this.cache},c.prototype.when=function(a,b){return this.rules.push({pattern:a,loader:b}),this},c.prototype.load=function(a){var b;return b=this,new d(function(c,d,f){function g(a,d){return function(){var e;e=this,b.cache[a]=e,h.assets[d]=e,i+=1,f&&f(this,i/j),i===j&&c()}}var h,i,j,k,l,m,n,o;for(h=this,i=0,j=a.length,j||c(),k=0;j>k;k+=1)if(l=a[k],m=b.get(l))g(l,k).call(m);else for(n=0;o=b.rules[n];n+=1)o.pattern.test(l)&&o.loader.load(e.join(b.basePath,l),g(l,k),d)})},b.exports=c},{"./assets-bundle":6,path:2}],8:[function(a,b){"use strict";function c(){}c.prototype.load=function(a,b,c){var d=new Image;d.onload=b,d.onerror=c,d.src=a},b.exports=c},{}],9:[function(a,b,c){"use strict";c.AssetsLoader=a("./assets-loader"),c.ImagesLoader=a("./images-loader"),c.JsonLoader=a("./json-loader")},{"./assets-loader":7,"./images-loader":8,"./json-loader":10}],10:[function(a,b){"use strict";function c(){}c.prototype.load=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.onreadystatechange=function(){if(!(d.readyState<4))if(200===d.status)try{b.call(JSON.parse(d.responseText))}catch(a){c(a)}else c(d)},d.send()},b.exports=c},{}],11:[function(a,b){"use strict";function c(a){var b,c,f,g;for(this.animations=Object.create(null),c=a.animations.length,b=0;c>b;b+=1)f=a.animations[b],g=d.get(e.join("animations",a.target,a.target+"@"+f+".json")),this.animations[f]=g;this.defaultAnimation=a.defaultAnimation||"idle",this.currentAnimation=this.defaultAnimation,this.currentFrame=0,this.loop=Boolean(a&&a.loop),this.timeElapsedSinceLastFrame=0}var d,e;d=a("game").loader,e=a("path"),b.exports=c},{game:"HPsMKw",path:2}],12:[function(a,b){"use strict";var c;c=a("./components/animations-component"),b.exports=nuclear.module("game.animations",["game.rendering"]).component("animations",function(a,b,d){return new c(b,d)}).system("animate",["sprite from game.rendering","atlas from game.rendering","animations from game.animations"],a("./systems/animate-system"),{msPerUpdate:16})},{"./components/animations-component":11,"./systems/animate-system":13}],13:[function(a,b){"use strict";b.exports=function(a,b,c,d){var e,f,g,h,i,j,k;e=b.atlas,f=b.sprite,g=b.animations,h=g.animations[g.currentAnimation],g.timeElapsedSinceLastFrame+=16*d,g.timeElapsedSinceLastFrame>h.interval&&(g.currentFrame+=1,g.timeElapsedSinceLastFrame-=h.interval,g.currentFrame>h.frames.length-1&&(g.currentFrame=0,g.loop||(g.currentAnimation=g.defaultAnimation,h=g.animations[g.currentAnimation])),i=e.sprites.frames[h.frames[g.currentFrame]].frame,j=f.width(),k=f.height(),f.context.clearRect(0,0,j,k),f.context.drawImage(e.source,i.x,i.y,i.w,i.h,0,0,j,k))}},{}],14:[function(a){"use strict";!function(b,c){function d(a,b){var c,e=b.inputs;for(var f in d.manager)c=d.manager[f],e[f]&&e[f](a,c,d.manager)}function e(a,b){var c=g.config("keyboard")[b];d.manager[c]=1}function f(a,b){var c=g.config("keyboard")[b];d.manager[c]=0}a("./lib/mousetrap.min");var g,h,i;h=a("./lib/gamepad.min").Gamepad,i=window.Mousetrap,g=b.module("inputs",[]),g.component("inputs",function(a,b){return b}),d.manager={},g.system("inputsManager",["inputs"],d,{msPerUpdate:50}),g.config({gamepad:{FACE_1:"",FACE_2:"",FACE_3:"",FACE_4:"",LEFT_TOP_SHOULDER:"",RIGHT_TOP_SHOULDER:"",LEFT_BOTTOM_SHOULDER:"",RIGHT_BOTTOM_SHOULDER:"",SELECT_BACK:"",START_FORWARD:"",LEFT_STICK_X:"LEFT_AXIS_X",RIGHT_STICK_X:"RIGHT_AXIS_X",LEFT_STICK_Y:"LEFT_AXIS_Y",RIGHT_STICK_Y:"RIGHT_AXIS_Y",DPAD_UP:"UP",DPAD_DOWN:"DOWN",DPAD_LEFT:"LEFT",DPAD_RIGHT:"RIGHT",HOME:""},keyboard:{a:"A",up:"UP",down:"DOWN",left:"LEFT",right:"RIGHT",z:"UP",q:"LEFT",s:"DOWN",d:"RIGHT"}});var j=new h;j.init(),j.bind(h.Event.CONNECTED,function(){c.log("[MODULE@INPUTS] GAMEPAD CONNECTED")}),j.bind(h.Event.UNCONNECTED,function(){c.log("[MODULE@INPUTS] GAMEPAD UNCONNECTED")}),j.bind(h.Event.BUTTON_DOWN,function(a){var b=g.config("gamepad")[a.control];d.manager[b]=1}),j.bind(h.Event.BUTTON_UP,function(a){var b=g.config("gamepad")[a.control];d.manager[b]=0}),j.bind(h.Event.AXIS_CHANGED,function(a){var b=g.config("gamepad")[a.axis];d.manager[b]=a.value});var k,l;l=g.config("keyboard");for(var m in l)k=m,i.bind(k,e,"keydown"),i.bind(k,f,"keyup");b.import([g])}(window.nuclear,window.console)},{"./lib/gamepad.min":15,"./lib/mousetrap.min":16}],15:[function(a,b){!function(a){"use strict";var b=function(){},c={getType:function(){return"null"},isSupported:function(){return!1},update:b},d=function(a){var c=this,d=window;this.update=b,this.requestAnimationFrame=a||d.requestAnimationFrame||d.webkitRequestAnimationFrame||d.mozRequestAnimationFrame,this.tickFunction=function(){c.update(),c.startTicker()},this.startTicker=function(){c.requestAnimationFrame.apply(d,[c.tickFunction])}};d.prototype.start=function(a){this.update=a||b,this.startTicker()};var e=function(){};e.prototype.update=b,e.prototype.start=function(a){this.update=a||b};var f=function(a,b){this.listener=a,this.gamepadGetter=b,this.knownGamepads=[]};f.factory=function(a){var b=c,d=window&&window.navigator;return d&&("undefined"!=typeof d.webkitGamepads?b=new f(a,function(){return d.webkitGamepads}):"undefined"!=typeof d.webkitGetGamepads&&(b=new f(a,function(){return d.webkitGetGamepads()}))),b},f.getType=function(){return"WebKit"},f.prototype.getType=function(){return f.getType()},f.prototype.isSupported=function(){return!0},f.prototype.update=function(){var a,b,c=this,d=Array.prototype.slice.call(this.gamepadGetter(),0);for(b=this.knownGamepads.length-1;b>=0;b--)a=this.knownGamepads[b],d.indexOf(a)<0&&(this.knownGamepads.splice(b,1),this.listener._disconnect(a));for(b=0;b<d.length;b++)a=d[b],a&&c.knownGamepads.indexOf(a)<0&&(c.knownGamepads.push(a),c.listener._connect(a))};var g=function(a){this.listener=a,window.addEventListener("gamepadconnected",function(b){a._connect(b.gamepad)}),window.addEventListener("gamepaddisconnected",function(b){a._disconnect(b.gamepad)})};g.factory=function(a){var b=c;return window&&"undefined"!=typeof window.addEventListener&&(b=new g(a)),b},g.getType=function(){return"Firefox"},g.prototype.getType=function(){return g.getType()},g.prototype.isSupported=function(){return!0},g.prototype.update=b;var h=function(a){this.updateStrategy=a||new d,this.gamepads=[],this.listeners={},this.platform=c,this.deadzone=.03,this.maximizeThreshold=.97};h.UpdateStrategies={AnimFrameUpdateStrategy:d,ManualUpdateStrategy:e},h.PlatformFactories=[f.factory,g.factory],h.Type={PLAYSTATION:"playstation",LOGITECH:"logitech",XBOX:"xbox",UNKNOWN:"unknown"},h.Event={CONNECTED:"connected",UNSUPPORTED:"unsupported",DISCONNECTED:"disconnected",TICK:"tick",BUTTON_DOWN:"button-down",BUTTON_UP:"button-up",AXIS_CHANGED:"axis-changed"},h.StandardButtons=["FACE_1","FACE_2","FACE_3","FACE_4","LEFT_TOP_SHOULDER","RIGHT_TOP_SHOULDER","LEFT_BOTTOM_SHOULDER","RIGHT_BOTTOM_SHOULDER","SELECT_BACK","START_FORWARD","LEFT_STICK","RIGHT_STICK","DPAD_UP","DPAD_DOWN","DPAD_LEFT","DPAD_RIGHT","HOME"],h.StandardAxes=["LEFT_STICK_X","LEFT_STICK_Y","RIGHT_STICK_X","RIGHT_STICK_Y"];var i=function(a,b,c){return b<a.length?a[b]:c+(b-a.length+1)};h.StandardMapping={env:{},buttons:{byButton:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]},axes:{byAxis:[0,1,2,3]}},h.Mappings=[{env:{platform:g.getType(),type:h.Type.PLAYSTATION},buttons:{byButton:[14,13,15,12,10,11,8,9,0,3,1,2,4,6,7,5,16]},axes:{byAxis:[0,1,2,3]}},{env:{platform:f.getType(),type:h.Type.LOGITECH},buttons:{byButton:[1,2,0,3,4,5,6,7,8,9,10,11,11,12,13,14,10]},axes:{byAxis:[0,1,2,3]}},{env:{platform:g.getType(),type:h.Type.LOGITECH},buttons:{byButton:[0,1,2,3,4,5,-1,-1,6,7,8,9,11,12,13,14,10],byAxis:[-1,-1,-1,-1,-1,-1,[2,0,1],[2,0,-1]]},axes:{byAxis:[0,1,3,4]}}],h.prototype.init=function(){var a=h.resolvePlatform(this),b=this;return this.platform=a,this.updateStrategy.start(function(){b._update()}),a.isSupported()},h.prototype.bind=function(a,b){return"undefined"==typeof this.listeners[a]&&(this.listeners[a]=[]),this.listeners[a].push(b),this},h.prototype.unbind=function(a,b){if("undefined"!=typeof a){if("undefined"!=typeof b){if("undefined"==typeof this.listeners[a])return!1;for(var c=0;c<this.listeners[a].length;c++)if(this.listeners[a][c]===b)return this.listeners[a].splice(c,1),!0;return!1}this.listeners[a]=[]}else this.listeners={}},h.prototype.count=function(){return this.gamepads.length},h.prototype._fire=function(a,b){if("undefined"!=typeof this.listeners[a])for(var c=0;c<this.listeners[a].length;c++)this.listeners[a][c].apply(this.listeners[a][c],[b])},h.getNullPlatform=function(){return Object.create(c)},h.resolvePlatform=function(a){var b,d=c;for(b=0;!d.isSupported()&&b<h.PlatformFactories.length;b++)d=h.PlatformFactories[b](a);return d},h.prototype._connect=function(a){var b,c,d=this._resolveMapping(a);for(a.state={},a.lastState={},a.updater=[],b=d.buttons.byButton.length,c=0;b>c;c++)this._addButtonUpdater(a,d,c);for(b=d.axes.byAxis.length,c=0;b>c;c++)this._addAxisUpdater(a,d,c);this.gamepads[a.index]=a,this._fire(h.Event.CONNECTED,a)},h.prototype._addButtonUpdater=function(a,c,d){var e=b,f=i(h.StandardButtons,d,"EXTRA_BUTTON_"),g=this._createButtonGetter(a,c.buttons,d),j=this,k={gamepad:a,control:f};a.state[f]=0,a.lastState[f]=0,e=function(){var b=g(),c=a.lastState[f],d=b>.5,e=c>.5;a.state[f]=b,d&&!e?j._fire(h.Event.BUTTON_DOWN,Object.create(k)):!d&&e&&j._fire(h.Event.BUTTON_UP,Object.create(k)),0!==b&&1!==b&&b!==c&&j._fireAxisChangedEvent(a,f,b),a.lastState[f]=b},a.updater.push(e)},h.prototype._addAxisUpdater=function(a,c,d){var e=b,f=i(h.StandardAxes,d,"EXTRA_AXIS_"),g=this._createAxisGetter(a,c.axes,d),j=this;a.state[f]=0,a.lastState[f]=0,e=function(){var b=g(),c=a.lastState[f];a.state[f]=b,b!==c&&j._fireAxisChangedEvent(a,f,b),a.lastState[f]=b},a.updater.push(e)},h.prototype._fireAxisChangedEvent=function(a,b,c){var d={gamepad:a,axis:b,value:c};this._fire(h.Event.AXIS_CHANGED,d)},h.prototype._createButtonGetter=function(){var a=function(){return 0},b=function(b,c,d){var e=a;return d>c?e=function(){var a=d-c,e=b();return e=(e-c)/a,0>e?0:e}:c>d&&(e=function(){var a=c-d,e=b();return e=(e-d)/a,e>1?0:1-e}),e},c=function(a){return"[object Array]"===Object.prototype.toString.call(a)};return function(d,e,f){var g,h=a,i=this;return g=e.byButton[f],-1!==g?"number"==typeof g&&g<d.buttons.length&&(h=function(){return d.buttons[g]}):e.byAxis&&f<e.byAxis.length&&(g=e.byAxis[f],c(g)&&3==g.length&&g[0]<d.axes.length&&(h=function(){var a=d.axes[g[0]];return i._applyDeadzoneMaximize(a)},h=b(h,g[1],g[2]))),h}}(),h.prototype._createAxisGetter=function(){var a=function(){return 0};return function(b,c,d){var e,f=a,g=this;return e=c.byAxis[d],-1!==e&&"number"==typeof e&&e<b.axes.length&&(f=function(){var a=b.axes[e];return g._applyDeadzoneMaximize(a)}),f}}(),h.prototype._disconnect=function(a){var b,c=[];for("undefined"!=typeof this.gamepads[a.index]&&delete this.gamepads[a.index],b=0;b<this.gamepads.length;b++)"undefined"!=typeof this.gamepads[b]&&(c[b]=this.gamepads[b]);this.gamepads=c,this._fire(h.Event.DISCONNECTED,a)},h.prototype._resolveControllerType=function(a){return a=a.toLowerCase(),-1!==a.indexOf("playstation")?h.Type.PLAYSTATION:-1!==a.indexOf("logitech")||-1!==a.indexOf("wireless gamepad")?h.Type.LOGITECH:-1!==a.indexOf("xbox")||-1!==a.indexOf("360")?h.Type.XBOX:h.Type.UNKNOWN},h.prototype._resolveMapping=function(a){var b,c,d=h.Mappings,e=null,f={platform:this.platform.getType(),type:this._resolveControllerType(a.id)};for(b=0;!e&&b<d.length;b++)c=d[b],h.envMatchesFilter(c.env,f)&&(e=c);return e||h.StandardMapping},h.envMatchesFilter=function(a,b){var c,d=!0;for(c in a)a[c]!==b[c]&&(d=!1);return d},h.prototype._update=function(){this.platform.update(),this.gamepads.forEach(function(a){a&&a.updater.forEach(function(a){a()})}),this.gamepads.length>0&&this._fire(h.Event.TICK,this.gamepads)},h.prototype._applyDeadzoneMaximize=function(a,b,c){return b="undefined"!=typeof b?b:this.deadzone,c="undefined"!=typeof c?c:this.maximizeThreshold,a>=0?b>a?a=0:a>c&&(a=1):a>-b?a=0:-c>a&&(a=-1),a},a.Gamepad=h}("undefined"!=typeof b&&b.exports||window)},{}],16:[function(){!function(a,b,c){function d(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}function e(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);return a.shiftKey||(b=b.toLowerCase()),b}return q[a.which]?q[a.which]:r[a.which]?r[a.which]:String.fromCharCode(a.which).toLowerCase()}function f(a){a=a||{};var b,c=!1;for(b in w)a[b]?c=!0:w[b]=0;c||(z=!1)}function g(a,b,c,d,e,f){var g,h,i=[],j=c.type;if(!u[a])return[];for("keyup"==j&&k(a)&&(b=[a]),g=0;g<u[a].length;++g)if(h=u[a][g],!(!d&&h.seq&&w[h.seq]!=h.level||j!=h.action||("keypress"!=j||c.metaKey||c.ctrlKey)&&b.sort().join(",")!==h.modifiers.sort().join(","))){var l=d&&h.seq==d&&h.level==f;(!d&&h.combo==e||l)&&u[a].splice(g,1),i.push(h)}return i}function h(a){var b=[];return a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),b}function i(a,b,c,d){A.stopCallback(b,b.target||b.srcElement,c,d)||!1!==a(b,c)||(b.preventDefault?b.preventDefault():b.returnValue=!1,b.stopPropagation?b.stopPropagation():b.cancelBubble=!0)}function j(a){"number"!=typeof a.which&&(a.which=a.keyCode);var b=e(a);b&&("keyup"==a.type&&x===b?x=!1:A.handleKey(b,h(a),a))}function k(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function l(a,b,c,d){function g(b){return function(){z=b,++w[a],clearTimeout(p),p=setTimeout(f,1e3)}}function h(b){i(c,b,a),"keyup"!==d&&(x=e(b)),setTimeout(f,10)}for(var j=w[a]=0;j<b.length;++j){var k=j+1===b.length?h:g(d||m(b[j+1]).action);n(b[j],k,d,a,j)}}function m(a,b){var c,d,e,f=[];for(c="+"===a?["+"]:a.split("+"),e=0;e<c.length;++e)d=c[e],t[d]&&(d=t[d]),b&&"keypress"!=b&&s[d]&&(d=s[d],f.push("shift")),k(d)&&f.push(d);if(c=d,e=b,!e){if(!o){o={};for(var g in q)g>95&&112>g||q.hasOwnProperty(g)&&(o[q[g]]=g)}e=o[c]?"keydown":"keypress"}return"keypress"==e&&f.length&&(e="keydown"),{key:d,modifiers:f,action:e}}function n(a,b,c,d,e){v[a+":"+c]=b,a=a.replace(/\s+/g," ");var f=a.split(" ");1<f.length?l(a,f,b,c):(c=m(a,c),u[c.key]=u[c.key]||[],g(c.key,c.modifiers,{type:c.action},d,a,e),u[c.key][d?"unshift":"push"]({callback:b,modifiers:c.modifiers,action:c.action,seq:d,level:e,combo:a}))}var o,p,q={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},r={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},s={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},t={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},u={},v={},w={},x=!1,y=!1,z=!1;for(c=1;20>c;++c)q[111+c]="f"+c;for(c=0;9>=c;++c)q[c+96]=c;d(b,"keypress",j),d(b,"keydown",j),d(b,"keyup",j);var A={bind:function(a,b,c){a=a instanceof Array?a:[a];for(var d=0;d<a.length;++d)n(a[d],b,c);return this},unbind:function(a,b){return A.bind(a,function(){},b)},trigger:function(a,b){return v[a+":"+b]&&v[a+":"+b]({},a),this},reset:function(){return u={},v={},this},stopCallback:function(a,b){return-1<(" "+b.className+" ").indexOf(" mousetrap ")?!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable},handleKey:function(a,b,c){var d,e=g(a,b,c);b={};var h=0,j=!1;for(d=0;d<e.length;++d)e[d].seq&&(h=Math.max(h,e[d].level));for(d=0;d<e.length;++d)e[d].seq?e[d].level==h&&(j=!0,b[e[d].seq]=1,i(e[d].callback,c,e[d].combo,e[d].seq)):j||i(e[d].callback,c,e[d].combo);e="keypress"==c.type&&y,c.type!=z||k(a)||e||f(b),y=j&&"keydown"==c.type}};a.Mousetrap=A,"function"==typeof define&&define.amd&&define(A)}(window,document)},{}],17:[function(a,b){"use strict";function c(a){this.source=e.get(d.join("atlases",a+".atlas.png")),this.sprites=e.get(d.join("atlases",a+".atlas.json"))}var d,e;d=a("path"),e=a("game").loader,b.exports=c},{game:"HPsMKw",path:2}],18:[function(a,b){"use strict";function c(a,b,c,d){this.buffer=document.createElement("canvas"),this.context=this.buffer.getContext("2d"),this.dest=d||0,void 0===c&&(c=!0),this.center=c,this.buffer.width=a,this.buffer.height=b,this.context.imageSmoothingEnabled=!1}var d,e;d=a("game").loader,e=a("path"),c.prototype.fromAtlas=function(a,b,c,f){var g,h;g=d.get(e.join("atlases",a+".atlas.png")),h=d.get(e.join("atlases",a+".atlas.json")).frames[b],c||(c=h.frame.w),f||(f=h.frame.h),this.width(c),this.height(f),this.context.drawImage(g,h.frame.x,h.frame.y,h.frame.w,h.frame.h,0,0,c,f)},c.prototype.width=function(a){return 0===arguments.length?this.buffer.width:(this.buffer.width=a,this.context.imageSmoothingEnabled=!1,this)},c.prototype.height=function(a){return 0===arguments.length?this.buffer.height:(this.buffer.height=a,this.context.imageSmoothingEnabled=!1,this)},b.exports=c},{game:"HPsMKw",path:2}],19:[function(a,b){"use strict";var c,d;c=a("./components/atlas-component"),d=a("./components/sprite-component"),b.exports=nuclear.module("game.rendering",["game.transform"]).component("atlas",function(a,b){return new c(b)}).component("sprite",function(a,b,c,e,f){return new d(b,c,e,f)}).system("renderer",["sprite from game.rendering","position from game.transform"],a("./systems/renderer-system"))},{"./components/atlas-component":17,"./components/sprite-component":18,"./systems/renderer-system":20}],20:[function(a,b){"use strict";nuclear.events.on("system:before:renderer from game.rendering",function(){var a;a=nuclear.system.context(),a.dests[1].clearRect(0,0,a.WIDTH,a.HEIGHT)}),b.exports=function(a,b,c){var d,e,f,g,h,i;d=b.sprite,e=b.position,f=c.dests[d.dest],g=d.width(),h=d.height(),i=d.center?.5:1,f.drawImage(d.buffer,e.x-g*i,e.y-h*i,g,h)}},{}],21:[function(a,b){"use strict";b.exports={templates:{one:{name:"one",slots:[{type:"crate",position:{x:30,y:20}},{type:"crate",position:{x:40,y:20}},{type:"crate",position:{x:100,y:10}}],light:"red",bundle:"stone"},two:{name:"two",slots:[{type:"crate",position:{x:30,y:20}},{type:"crate",position:{x:40,y:20}},{type:"crate",position:{x:100,y:10}}],light:"red",bundle:"stone"},three:{name:"three",slots:[{type:"crate",position:{x:30,y:20}},{type:"crate",position:{x:40,y:20}},{type:"crate",position:{x:100,y:10}}],light:"red",bundle:"stone"},four:{name:"four",slots:[{type:"crate",position:{x:30,y:20}},{type:"crate",position:{x:40,y:20}},{type:"crate",position:{x:100,y:10}}],light:"red",bundle:"stone"}},ranges:{one:[9,14],two:[15,25],three:[26,40],four:[41,200]},slots:{torch:{components:["destructible","collider","sprite","scale"],data:{}},crate:{components:[],data:{sprite:[0,120,120],atlas:[0,"crate"]}}},bundles:{stone:{upperLeft:[{index:1}],upperLeft_top:[{index:0,h:.75,y:-119,dest:2}],downLeft:[{index:3}],downLeft_top:[{index:2,h:.75,y:-119,dest:2}],upperRight:[{index:5}],upperRight_top:[{index:4,h:.75,y:-119,dest:2}],downRight:[{index:7}],downRight_top:[{index:6,h:.75,y:-119,dest:2}],ground:[{index:8},{index:9},{index:10}],left:[{index:11}],right:[{index:12}],up:[{index:14},{index:16},{index:18}],up_top:[{index:13,h:.75,y:-119,dest:2},{index:15,h:.75,y:-119,dest:2},{index:17,h:.75,y:-119,dest:2}],down:[{index:19,y:-119,h:.75,dest:2}],upperExternalRight:[{index:22,y:30,h:2,w:.4,x:-72}],upperExternalLeft:[{index:21,y:30,h:2,w:.4}],doubleSides:[{index:23}],downExternalLeft:[{index:26,y:-15,h:1.6,dest:2}],downExternalRight:[{index:24,y:-15,h:1.6,dest:2}]}},resolution:120,currentBundle:"stone"}},{}],22:[function(a,b){"use strict";var c,d,e,f;d=a("./template"),f=a("./map"),e=a("./config"),c=nuclear.module("roguemap",[]),c.component("map",function(a,b){return new f(b)}),c.component("rooms_manager",function(a,b){return b}),c.component("room",function(a,b){var c={};return c.position={x:b._x1,y:b._y1},c.width=b._x2-b._x1,c.height=b._y2-b._y1,c.size=c.width*c.height,c}),c.component("template",function(a,b){var c=new d(a,b.position,b.width,b.height,b.config);return c}),c.entity("room",function(a,b){var d,e,f,g,h=nuclear.component("room").add(a,b),i=c.config("ranges"),j=c.config("templates");for(var k in i){for(d=i[k],e=!1,f=d[0];f<d[1];f++)h.size===f&&(e=!0,g=j[k],nuclear.component("template").add(a,{config:g,width:h.width,height:h.height,position:h.position}));if(e)break}}),c.entity("map",function(a,b){var d=nuclear.component("map from roguemap").add(a,b.mapData).map;console.log(d);for(var e=[],f=0;f<d._rooms.length;f++){var g=d._rooms[f];e.push(c.entity("room").create(g))}nuclear.component("rooms_manager from roguemap").add(a,e)}),c.entity("tile",function(a,b){var d=c.config("resolution"),e=c.config("bundles"),f=c.config("currentBundle"),g=e[f];if(g&&g[b.type]){var h,i,j,k,l,m=g[b.type][Math.round(Math.random()*(g[b.type].length-1))],n=m.index;h=m.w||1,i=m.h||1,j=m.x||0,k=m.y||0,nuclear.component("position from game.transform").add(a,b.x*d+j,b.y*d+k),l=nuclear.component("sprite from game.rendering").add(a,d*h,d*i,!1,m.dest),l.fromAtlas(f,n,d*h,d*i),nuclear.system("renderer from game.rendering").once(a),nuclear.component("sprite").remove(a)}}),c.component("slot",function(a,b){var c,d,e;for(c=0;c<b.components.length;c++)d=b.components[c],e=b.data[d],d=nuclear.component(d),e[0]=a,d.add.apply(d,e);return b}),c.entity("slot",function(a,b){var d=c.config("slots"),e=d[b.type],f=c.config("resolution");e={components:e.components,data:e.data,position:b.position,bundle:b.bundle,template:b.template},nuclear.component("slot").add(a,e),nuclear.component("position").add(a,b.position.x*f,b.position.y*f)}),c.config(e||{templates:{},ranges:{},slots:{},resolution:20,bundles:{},currentBundle:"stone"}),nuclear.import([c]),b.exports=c},{"./config":21,"./map":24,"./template":25}],23:[function(){window.ROT={isSupported:function(){return!(!document.createElement("canvas").getContext||!Function.prototype.bind)},DEFAULT_WIDTH:80,DEFAULT_HEIGHT:25,DIRS:{4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95},ROT.Text={RE_COLORS:/%([bc]){([^}]*)}/g,TYPE_TEXT:0,TYPE_NEWLINE:1,TYPE_FG:2,TYPE_BG:3,measure:function(a,b){for(var c={width:0,height:1},d=this.tokenize(a,b),e=0,f=0;f<d.length;f++){var g=d[f];switch(g.type){case this.TYPE_TEXT:e+=g.value.length;break;case this.TYPE_NEWLINE:c.height++,c.width=Math.max(c.width,e),e=0}}return c.width=Math.max(c.width,e),c},tokenize:function(a,b){var c=[],d=0;a.replace(this.RE_COLORS,function(b,e,f,g){var h=a.substring(d,g);return h.length&&c.push({type:ROT.Text.TYPE_TEXT,value:h}),c.push({type:"c"==e?ROT.Text.TYPE_FG:ROT.Text.TYPE_BG,value:f.trim()}),d=g+b.length,""});var e=a.substring(d);return e.length&&c.push({type:ROT.Text.TYPE_TEXT,value:e}),this._breakLines(c,b)},_breakLines:function(a,b){b||(b=1/0);for(var c=0,d=0,e=-1;c<a.length;){var f=a[c];if(f.type==ROT.Text.TYPE_NEWLINE&&(d=0,e=-1),f.type==ROT.Text.TYPE_TEXT){for(;0==d&&" "==f.value.charAt(0);)f.value=f.value.substring(1);var g=f.value.indexOf("\n");if(-1!=g){f.value=this._breakInsideToken(a,c,g,!0);for(var h=f.value.split("");" "==h[h.length-1];)h.pop();f.value=h.join("")}if(f.value.length){if(d+f.value.length>b){for(var g=-1;;){var i=f.value.indexOf(" ",g+1);if(-1==i)break;if(d+i>b)break;g=i}if(-1!=g)f.value=this._breakInsideToken(a,c,g,!0);else if(-1!=e){var f=a[e],j=f.value.lastIndexOf(" ");f.value=this._breakInsideToken(a,e,j,!0),c=e}else f.value=this._breakInsideToken(a,c,b-d,!1)}else d+=f.value.length,-1!=f.value.indexOf(" ")&&(e=c);c++}else a.splice(c,1)}else c++}a.push({type:ROT.Text.TYPE_NEWLINE});for(var k=null,c=0;c<a.length;c++){var f=a[c];switch(f.type){case ROT.Text.TYPE_TEXT:k=f;break;case ROT.Text.TYPE_NEWLINE:if(k){for(var h=k.value.split("");" "==h[h.length-1];)h.pop();k.value=h.join("")}k=null}}return a.pop(),a},_breakInsideToken:function(a,b,c,d){var e={type:ROT.Text.TYPE_NEWLINE},f={type:ROT.Text.TYPE_TEXT,value:a[b].value.substring(c+(d?1:0))};return a.splice(b+1,0,e,f),a[b].value.substring(0,c)}},Array.prototype.random=function(){return this.length?this[Math.floor(ROT.RNG.getUniform()*this.length)]:null
},Array.prototype.randomize=function(){for(var a=[];this.length;){var b=this.indexOf(this.random());a.push(this.splice(b,1)[0])}return a},Number.prototype.mod=function(a){return(this%a+a)%a},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.substring(1)},String.prototype.lpad=function(a,b){for(var c=a||"0",d=b||2,e="";e.length<d-this.length;)e+=c;return e=e.substring(0,d-this.length),e+this},String.prototype.rpad=function(a,b){for(var c=a||"0",d=b||2,e="";e.length<d-this.length;)e+=c;return e=e.substring(0,d-this.length),this+e},String.format=function(a){var b=String.format.map,c=Array.prototype.slice.call(arguments,1),d=function(d,e,f,g){if("%"==a.charAt(g-1))return d.substring(1);if(!c.length)return d;var h=c[0],i=e||f,j=i.split(","),k=j.shift(),l=b[k.toLowerCase()];if(!l)return d;var h=c.shift(),m=h[l].apply(h,j),n=k.charAt(0);return n!=n.toLowerCase()&&(m=m.capitalize()),m};return a.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,d)},String.format.map={s:"toString"},String.prototype.format=function(){var a=Array.prototype.slice.call(arguments);return a.unshift(this),String.format.apply(String,a)},Object.create||(Object.create=function(a){var b=function(){};return b.prototype=a,new b}),Function.prototype.extend=function(a){return this.prototype=Object.create(a.prototype),this.prototype.constructor=this,this},window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(a){return clearTimeout(a)},ROT.Display=function(a){var b=document.createElement("canvas");this._context=b.getContext("2d"),this._data={},this._dirty=!1,this._options={},this._backend=null;var c={width:ROT.DEFAULT_WIDTH,height:ROT.DEFAULT_HEIGHT,layout:"rect",fontSize:15,spacing:1,border:0,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null};for(var d in a)c[d]=a[d];this.setOptions(c),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),requestAnimationFrame(this._tick)},ROT.Display.prototype.DEBUG=function(a,b,c){var d=[this._options.bg,this._options.fg];this.draw(a,b,null,null,d[c%d.length])},ROT.Display.prototype.clear=function(){this._data={},this._dirty=!0},ROT.Display.prototype.setOptions=function(a){for(var b in a)this._options[b]=a[b];if(a.width||a.height||a.fontSize||a.fontFamily||a.spacing||a.layout){a.layout&&(this._backend=new(ROT.Display[a.layout.capitalize()])(this._context));var c=(this._options.fontStyle?this._options.fontStyle+" ":"")+this._options.fontSize+"px "+this._options.fontFamily;this._context.font=c,this._backend.compute(this._options),this._context.font=c,this._context.textAlign="center",this._context.textBaseline="middle",this._dirty=!0}return this},ROT.Display.prototype.getOptions=function(){return this._options},ROT.Display.prototype.getContainer=function(){return this._context.canvas},ROT.Display.prototype.computeSize=function(a,b){return this._backend.computeSize(a,b,this._options)},ROT.Display.prototype.computeFontSize=function(a,b){return this._backend.computeFontSize(a,b,this._options)},ROT.Display.prototype.eventToPosition=function(a){if(a.touches)var b=a.touches[0].clientX,c=a.touches[0].clientY;else var b=a.clientX,c=a.clientY;var d=this._context.canvas.getBoundingClientRect();return b-=d.left,c-=d.top,0>b||0>c||b>=this._context.canvas.width||c>=this._context.canvas.height?[-1,-1]:this._backend.eventToPosition(b,c)},ROT.Display.prototype.draw=function(a,b,c,d,e){d||(d=this._options.fg),e||(e=this._options.bg),this._data[a+","+b]=[a,b,c,d,e],this._dirty!==!0&&(this._dirty||(this._dirty={}),this._dirty[a+","+b]=!0)},ROT.Display.prototype.drawText=function(a,b,c,d){var e=null,f=null,g=a,h=b,i=1;d||(d=this._options.width-a);for(var j=ROT.Text.tokenize(c,d);j.length;){var k=j.shift();switch(k.type){case ROT.Text.TYPE_TEXT:for(var l=0;l<k.value.length;l++)this.draw(g++,h,k.value.charAt(l),e,f);break;case ROT.Text.TYPE_FG:e=k.value||null;break;case ROT.Text.TYPE_BG:f=k.value||null;break;case ROT.Text.TYPE_NEWLINE:g=a,h++,i++}}return i},ROT.Display.prototype._tick=function(){if(requestAnimationFrame(this._tick),this._dirty){if(this._dirty===!0){this._context.fillStyle=this._options.bg,this._context.fillRect(0,0,this._context.canvas.width,this._context.canvas.height);for(var a in this._data)this._draw(a,!1)}else for(var b in this._dirty)this._draw(b,!0);this._dirty=!1}},ROT.Display.prototype._draw=function(a,b){var c=this._data[a];c[4]!=this._options.bg&&(b=!0),this._backend.draw(c,b)},ROT.Display.Backend=function(a){this._context=a},ROT.Display.Backend.prototype.compute=function(){},ROT.Display.Backend.prototype.draw=function(){},ROT.Display.Backend.prototype.computeSize=function(){},ROT.Display.Backend.prototype.computeFontSize=function(){},ROT.Display.Backend.prototype.eventToPosition=function(){},ROT.Display.Rect=function(a){ROT.Display.Backend.call(this,a),this._spacingX=0,this._spacingY=0,this._canvasCache={},this._options={}},ROT.Display.Rect.extend(ROT.Display.Backend),ROT.Display.Rect.cache=!1,ROT.Display.Rect.prototype.compute=function(a){this._canvasCache={},this._options=a;var b=Math.ceil(this._context.measureText("W").width);this._spacingX=Math.ceil(a.spacing*b),this._spacingY=Math.ceil(a.spacing*a.fontSize),this._context.canvas.width=a.width*this._spacingX,this._context.canvas.height=a.height*this._spacingY},ROT.Display.Rect.prototype.draw=function(a,b){this.constructor.cache?this._drawWithCache(a,b):this._drawNoCache(a,b)},ROT.Display.Rect.prototype._drawWithCache=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=""+d+e+f;if(g in this._canvasCache)var h=this._canvasCache[g];else{var i=this._options.border,h=document.createElement("canvas"),j=h.getContext("2d");if(h.width=this._spacingX,h.height=this._spacingY,j.fillStyle=f,j.fillRect(i,i,h.width-i,h.height-i),d){j.fillStyle=e,j.font=this._context.font,j.textAlign="center",j.textBaseline="middle";for(var k=[].concat(d),l=0;l<k.length;l++)j.fillText(k[l],this._spacingX/2,this._spacingY/2)}this._canvasCache[g]=h}this._context.drawImage(h,b*this._spacingX,c*this._spacingY)},ROT.Display.Rect.prototype._drawNoCache=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4];if(b){var h=this._options.border;this._context.fillStyle=g,this._context.fillRect(c*this._spacingX+h,d*this._spacingY+h,this._spacingX-h,this._spacingY-h)}if(e){this._context.fillStyle=f;for(var i=[].concat(e),j=0;j<i.length;j++)this._context.fillText(i[j],(c+.5)*this._spacingX,(d+.5)*this._spacingY)}},ROT.Display.Rect.prototype.computeSize=function(a,b){var c=Math.floor(a/this._spacingX),d=Math.floor(b/this._spacingY);return[c,d]},ROT.Display.Rect.prototype.computeFontSize=function(a,b){var c=Math.floor(a/this._options.width),d=Math.floor(b/this._options.height),e=this._context.font;this._context.font="100px "+this._options.fontFamily;var f=Math.ceil(this._context.measureText("W").width);this._context.font=e;var g=f/100,h=g*d/c;return h>1&&(d=Math.floor(d/h)),Math.floor(d/this._options.spacing)},ROT.Display.Rect.prototype.eventToPosition=function(a,b){return[Math.floor(a/this._spacingX),Math.floor(b/this._spacingY)]},ROT.Display.Hex=function(a){ROT.Display.Backend.call(this,a),this._spacingX=0,this._spacingY=0,this._hexSize=0,this._options={}},ROT.Display.Hex.extend(ROT.Display.Backend),ROT.Display.Hex.prototype.compute=function(a){this._options=a;var b=Math.ceil(this._context.measureText("W").width);this._hexSize=Math.floor(a.spacing*(a.fontSize+b/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,this._context.canvas.width=Math.ceil((a.width+1)*this._spacingX),this._context.canvas.height=Math.ceil((a.height-1)*this._spacingY+2*this._hexSize)},ROT.Display.Hex.prototype.draw=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=(c+1)*this._spacingX,i=d*this._spacingY+this._hexSize;if(b&&(this._context.fillStyle=g,this._fill(h,i)),e){this._context.fillStyle=f;for(var j=[].concat(e),k=0;k<j.length;k++)this._context.fillText(j[k],h,i)}},ROT.Display.Hex.prototype.computeSize=function(a,b){var c=Math.floor(a/this._spacingX)-1,d=Math.floor((b-2*this._hexSize)/this._spacingY+1);return[c,d]},ROT.Display.Hex.prototype.computeFontSize=function(a,b){var c=2*a/((this._options.width+1)*Math.sqrt(3))-1,d=b/(2+1.5*(this._options.height-1)),e=Math.min(c,d),f=this._context.font;this._context.font="100px "+this._options.fontFamily;var g=Math.ceil(this._context.measureText("W").width);this._context.font=f;var h=g/100;e=Math.floor(e)+1;var i=2*e/(this._options.spacing*(1+h/Math.sqrt(3)));return Math.ceil(i)-1},ROT.Display.Hex.prototype.eventToPosition=function(a,b){var c=this._context.canvas.height/this._options.height;return b=Math.floor(b/c),b.mod(2)?(a-=this._spacingX,a=1+2*Math.floor(a/(2*this._spacingX))):a=2*Math.floor(a/(2*this._spacingX)),[a,b]},ROT.Display.Hex.prototype._fill=function(a,b){var c=this._hexSize,d=this._options.border;this._context.beginPath(),this._context.moveTo(a,b-c+d),this._context.lineTo(a+this._spacingX-d,b-c/2+d),this._context.lineTo(a+this._spacingX-d,b+c/2-d),this._context.lineTo(a,b+c-d),this._context.lineTo(a-this._spacingX+d,b+c/2-d),this._context.lineTo(a-this._spacingX+d,b-c/2+d),this._context.lineTo(a,b-c+d),this._context.fill()},ROT.Display.Tile=function(a){ROT.Display.Rect.call(this,a),this._options={}},ROT.Display.Tile.extend(ROT.Display.Rect),ROT.Display.Tile.prototype.compute=function(a){this._options=a,this._context.canvas.width=a.width*a.tileWidth,this._context.canvas.height=a.height*a.tileHeight},ROT.Display.Tile.prototype.draw=function(a,b){var c=a[0],d=a[1],e=a[2],f=(a[3],a[4]),g=this._options.tileWidth,h=this._options.tileHeight;if(b){{this._options.border}this._context.fillStyle=f,this._context.fillRect(c*g,d*h,g,h)}if(e)for(var i=[].concat(e),j=0;j<i.length;j++){var k=this._options.tileMap[i[j]];if(!k)throw new Error("Char '"+i[j]+"' not found in tileMap");this._context.drawImage(this._options.tileSet,k[0],k[1],g,h,c*g,d*h,g,h)}},ROT.Display.Tile.prototype.computeSize=function(a,b){var c=Math.floor(a/this._options.tileWidth),d=Math.floor(b/this._options.tileHeight);return[c,d]},ROT.Display.Tile.prototype.computeFontSize=function(a,b){var c=Math.floor(a/this._options.width),d=Math.floor(b/this._options.height);return[c,d]},ROT.RNG={getSeed:function(){return this._seed},setSeed:function(a){return a=1>a?1/a:a,this._seed=a,this._s0=(a>>>0)*this._frac,a=69069*a+1>>>0,this._s1=a*this._frac,a=69069*a+1>>>0,this._s2=a*this._frac,this._c=1,this},getUniform:function(){var a=2091639*this._s0+this._c*this._frac;return this._s0=this._s1,this._s1=this._s2,this._c=0|a,this._s2=a-this._c,this._s2},getUniformInt:function(a,b){var c=Math.max(a,b),d=Math.min(a,b);return Math.floor(this.getUniform()*(c-d+1))+d},getNormal:function(a,b){do var c=2*this.getUniform()-1,d=2*this.getUniform()-1,e=c*c+d*d;while(e>1||0==e);var f=c*Math.sqrt(-2*Math.log(e)/e);return(a||0)+f*(b||1)},getPercentage:function(){return 1+Math.floor(100*this.getUniform())},getWeightedValue:function(a){var b=0;for(var c in a)b+=a[c];var d=Math.floor(this.getUniform()*b),e=0;for(var c in a)if(e+=a[c],e>d)return c;return null},getState:function(){return[this._s0,this._s1,this._s2,this._c]},setState:function(a){return this._s0=a[0],this._s1=a[1],this._s2=a[2],this._c=a[3],this},_s0:0,_s1:0,_s2:0,_c:0,_frac:2.3283064365386963e-10},ROT.RNG.setSeed(Date.now()),ROT.StringGenerator=function(a){this._options={words:!1,order:3,prior:.001};for(var b in a)this._options[b]=a[b];this._boundary=String.fromCharCode(0),this._suffix=this._boundary,this._prefix=[];for(var c=0;c<this._options.order;c++)this._prefix.push(this._boundary);this._priorValues={},this._priorValues[this._boundary]=this._options.prior,this._data={}},ROT.StringGenerator.prototype.clear=function(){this._data={},this._priorValues={}},ROT.StringGenerator.prototype.generate=function(){for(var a=[this._sample(this._prefix)];a[a.length-1]!=this._boundary;)a.push(this._sample(a));return this._join(a.slice(0,-1))},ROT.StringGenerator.prototype.observe=function(a){for(var b=this._split(a),c=0;c<b.length;c++)this._priorValues[b[c]]=this._options.prior;b=this._prefix.concat(b).concat(this._suffix);for(var c=this._options.order;c<b.length;c++)for(var d=b.slice(c-this._options.order,c),e=b[c],f=0;f<d.length;f++){var g=d.slice(f);this._observeEvent(g,e)}},ROT.StringGenerator.prototype.getStats=function(){var a=[],b=0;for(var c in this._priorValues)b++;b--,a.push("distinct samples: "+b);var d=0,e=0;for(var c in this._data){d++;for(var f in this._data[c])e++}return a.push("dictionary size (contexts): "+d),a.push("dictionary size (events): "+e),a.join(", ")},ROT.StringGenerator.prototype._split=function(a){return a.split(this._options.words?/\s+/:"")},ROT.StringGenerator.prototype._join=function(a){return a.join(this._options.words?" ":"")},ROT.StringGenerator.prototype._observeEvent=function(a,b){var c=this._join(a);c in this._data||(this._data[c]={});var d=this._data[c];b in d||(d[b]=0),d[b]++},ROT.StringGenerator.prototype._sample=function(a){a=this._backoff(a);var b=this._join(a),c=this._data[b],d={};if(this._options.prior){for(var e in this._priorValues)d[e]=this._priorValues[e];for(var e in c)d[e]+=c[e]}else d=c;return this._pickRandom(d)},ROT.StringGenerator.prototype._backoff=function(a){for(a.length>this._options.order?a=a.slice(-this._options.order):a.length<this._options.order&&(a=this._prefix.slice(0,this._options.order-a.length).concat(a));!(this._join(a)in this._data)&&a.length>0;)a=a.slice(1);return a},ROT.StringGenerator.prototype._pickRandom=function(a){var b=0;for(var c in a)b+=a[c];var d=ROT.RNG.getUniform()*b,e=0;for(var c in a)if(e+=a[c],e>d)return c},ROT.EventQueue=function(){this._time=0,this._events=[],this._eventTimes=[]},ROT.EventQueue.prototype.getTime=function(){return this._time},ROT.EventQueue.prototype.clear=function(){return this._events=[],this._eventTimes=[],this},ROT.EventQueue.prototype.add=function(a,b){for(var c=this._events.length,d=0;d<this._eventTimes.length;d++)if(this._eventTimes[d]>b){c=d;break}this._events.splice(c,0,a),this._eventTimes.splice(c,0,b)},ROT.EventQueue.prototype.get=function(){if(!this._events.length)return null;var a=this._eventTimes.splice(0,1)[0];if(a>0){this._time+=a;for(var b=0;b<this._eventTimes.length;b++)this._eventTimes[b]-=a}return this._events.splice(0,1)[0]},ROT.EventQueue.prototype.remove=function(a){var b=this._events.indexOf(a);return-1==b?!1:(this._remove(b),!0)},ROT.EventQueue.prototype._remove=function(a){this._events.splice(a,1),this._eventTimes.splice(a,1)},ROT.Scheduler=function(){this._queue=new ROT.EventQueue,this._repeat=[],this._current=null},ROT.Scheduler.prototype.getTime=function(){return this._queue.getTime()},ROT.Scheduler.prototype.add=function(a,b){return b&&this._repeat.push(a),this},ROT.Scheduler.prototype.clear=function(){return this._queue.clear(),this._repeat=[],this._current=null,this},ROT.Scheduler.prototype.remove=function(a){var b=this._queue.remove(a),c=this._repeat.indexOf(a);return-1!=c&&this._repeat.splice(c,1),this._current==a&&(this._current=null),b},ROT.Scheduler.prototype.next=function(){return this._current=this._queue.get(),this._current},ROT.Scheduler.Simple=function(){ROT.Scheduler.call(this)},ROT.Scheduler.Simple.extend(ROT.Scheduler),ROT.Scheduler.Simple.prototype.add=function(a,b){return this._queue.add(a,0),ROT.Scheduler.prototype.add.call(this,a,b)},ROT.Scheduler.Simple.prototype.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0),ROT.Scheduler.prototype.next.call(this)},ROT.Scheduler.Speed=function(){ROT.Scheduler.call(this)},ROT.Scheduler.Speed.extend(ROT.Scheduler),ROT.Scheduler.Speed.prototype.add=function(a,b){return this._queue.add(a,1/a.getSpeed()),ROT.Scheduler.prototype.add.call(this,a,b)},ROT.Scheduler.Speed.prototype.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed()),ROT.Scheduler.prototype.next.call(this)},ROT.Scheduler.Action=function(){ROT.Scheduler.call(this),this._defaultDuration=1,this._duration=this._defaultDuration},ROT.Scheduler.Action.extend(ROT.Scheduler),ROT.Scheduler.Action.prototype.add=function(a,b,c){return this._queue.add(a,c||this._defaultDuration),ROT.Scheduler.prototype.add.call(this,a,b)},ROT.Scheduler.Action.prototype.clear=function(){return this._duration=this._defaultDuration,ROT.Scheduler.prototype.clear.call(this)},ROT.Scheduler.Action.prototype.remove=function(a){return a==this._current&&(this._duration=this._defaultDuration),ROT.Scheduler.prototype.remove.call(this,a)},ROT.Scheduler.Action.prototype.next=function(){return this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),ROT.Scheduler.prototype.next.call(this)},ROT.Scheduler.Action.prototype.setDuration=function(a){return this._current&&(this._duration=a),this},ROT.Engine=function(a){this._scheduler=a,this._lock=1},ROT.Engine.prototype.start=function(){return this.unlock()},ROT.Engine.prototype.lock=function(){return this._lock++,this},ROT.Engine.prototype.unlock=function(){if(!this._lock)throw new Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){var a=this._scheduler.next();if(!a)return this.lock();var b=a.act();b&&b.then&&(this.lock(),b.then(this.unlock.bind(this)))}return this},ROT.Map=function(a,b){this._width=a||ROT.DEFAULT_WIDTH,this._height=b||ROT.DEFAULT_HEIGHT},ROT.Map.prototype.create=function(){},ROT.Map.prototype._fillMap=function(a){for(var b=[],c=0;c<this._width;c++){b.push([]);for(var d=0;d<this._height;d++)b[c].push(a)}return b},ROT.Map.Arena=function(a,b){ROT.Map.call(this,a,b)},ROT.Map.Arena.extend(ROT.Map),ROT.Map.Arena.prototype.create=function(a){for(var b=this._width-1,c=this._height-1,d=0;b>=d;d++)for(var e=0;c>=e;e++){var f=d&&e&&b>d&&c>e;a(d,e,f?0:1)}return this},ROT.Map.DividedMaze=function(a,b){ROT.Map.call(this,a,b),this._stack=[]},ROT.Map.DividedMaze.extend(ROT.Map),ROT.Map.DividedMaze.prototype.create=function(a){var b=this._width,c=this._height;this._map=[];for(var d=0;b>d;d++){this._map.push([]);for(var e=0;c>e;e++){var f=0==d||0==e||d+1==b||e+1==c;this._map[d].push(f?1:0)}}this._stack=[[1,1,b-2,c-2]],this._process();for(var d=0;b>d;d++)for(var e=0;c>e;e++)a(d,e,this._map[d][e]);return this._map=null,this},ROT.Map.DividedMaze.prototype._process=function(){for(;this._stack.length;){var a=this._stack.shift();this._partitionRoom(a)}},ROT.Map.DividedMaze.prototype._partitionRoom=function(a){for(var b=[],c=[],d=a[0]+1;d<a[2];d++){var e=this._map[d][a[1]-1],f=this._map[d][a[3]+1];!e||!f||d%2||b.push(d)}for(var g=a[1]+1;g<a[3];g++){var h=this._map[a[0]-1][g],i=this._map[a[2]+1][g];!h||!i||g%2||c.push(g)}if(b.length&&c.length){var j=b.random(),k=c.random();this._map[j][k]=1;var l=[],m=[];l.push(m);for(var d=a[0];j>d;d++)this._map[d][k]=1,m.push([d,k]);var m=[];l.push(m);for(var d=j+1;d<=a[2];d++)this._map[d][k]=1,m.push([d,k]);var m=[];l.push(m);for(var g=a[1];k>g;g++)this._map[j][g]=1,m.push([j,g]);var m=[];l.push(m);for(var g=k+1;g<=a[3];g++)this._map[j][g]=1,m.push([j,g]);for(var n=l.random(),d=0;d<l.length;d++){var m=l[d];if(m!=n){var o=m.random();this._map[o[0]][o[1]]=0}}this._stack.push([a[0],a[1],j-1,k-1]),this._stack.push([j+1,a[1],a[2],k-1]),this._stack.push([a[0],k+1,j-1,a[3]]),this._stack.push([j+1,k+1,a[2],a[3]])}},ROT.Map.IceyMaze=function(a,b,c){ROT.Map.call(this,a,b),this._regularity=c||0},ROT.Map.IceyMaze.extend(ROT.Map),ROT.Map.IceyMaze.prototype.create=function(a){var b=this._width,c=this._height,d=this._fillMap(1);b-=b%2?1:2,c-=c%2?1:2;var e=0,f=0,g=0,h=0,i=0,j=!1,k=[[0,0],[0,0],[0,0],[0,0]];do if(e=1+2*Math.floor(ROT.RNG.getUniform()*(b-1)/2),f=1+2*Math.floor(ROT.RNG.getUniform()*(c-1)/2),i||(d[e][f]=0),!d[e][f]){this._randomize(k);do{0==Math.floor(ROT.RNG.getUniform()*(this._regularity+1))&&this._randomize(k),j=!0;for(var l=0;4>l;l++)if(g=e+2*k[l][0],h=f+2*k[l][1],this._isFree(d,g,h,b,c)){d[g][h]=0,d[e+k[l][0]][f+k[l][1]]=0,e=g,f=h,j=!1,i++;break}}while(!j)}while(b*c/4>i+1);for(var l=0;l<this._width;l++)for(var m=0;m<this._height;m++)a(l,m,d[l][m]);return this._map=null,this},ROT.Map.IceyMaze.prototype._randomize=function(a){for(var b=0;4>b;b++)a[b][0]=0,a[b][1]=0;switch(Math.floor(4*ROT.RNG.getUniform())){case 0:a[0][0]=-1,a[1][0]=1,a[2][1]=-1,a[3][1]=1;break;case 1:a[3][0]=-1,a[2][0]=1,a[1][1]=-1,a[0][1]=1;break;case 2:a[2][0]=-1,a[3][0]=1,a[0][1]=-1,a[1][1]=1;break;case 3:a[1][0]=-1,a[0][0]=1,a[3][1]=-1,a[2][1]=1}},ROT.Map.IceyMaze.prototype._isFree=function(a,b,c,d,e){return 1>b||1>c||b>=d||c>=e?!1:a[b][c]},ROT.Map.EllerMaze=function(a,b){ROT.Map.call(this,a,b)},ROT.Map.EllerMaze.extend(ROT.Map),ROT.Map.EllerMaze.prototype.create=function(a){for(var b=this._fillMap(1),c=Math.ceil((this._width-2)/2),d=.375,e=[],f=[],g=0;c>g;g++)e.push(g),f.push(g);e.push(c-1);for(var h=1;h+3<this._height;h+=2)for(var g=0;c>g;g++){var i=2*g+1,j=h;b[i][j]=0,g!=e[g+1]&&ROT.RNG.getUniform()>d&&(this._addToList(g,e,f),b[i+1][j]=0),g!=e[g]&&ROT.RNG.getUniform()>d?this._removeFromList(g,e,f):b[i][j+1]=0}for(var g=0;c>g;g++){var i=2*g+1,j=h;b[i][j]=0,g!=e[g+1]&&(g==e[g]||ROT.RNG.getUniform()>d)&&(this._addToList(g,e,f),b[i+1][j]=0),this._removeFromList(g,e,f)}for(var g=0;g<this._width;g++)for(var h=0;h<this._height;h++)a(g,h,b[g][h]);return this},ROT.Map.EllerMaze.prototype._removeFromList=function(a,b,c){c[b[a]]=c[a],b[c[a]]=b[a],c[a]=a,b[a]=a},ROT.Map.EllerMaze.prototype._addToList=function(a,b,c){c[b[a+1]]=c[a],b[c[a]]=b[a+1],c[a]=a+1,b[a+1]=a},ROT.Map.Cellular=function(a,b,c){ROT.Map.call(this,a,b),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(c),this._dirs=ROT.DIRS[this._options.topology],this._map=this._fillMap(0)},ROT.Map.Cellular.extend(ROT.Map),ROT.Map.Cellular.prototype.randomize=function(a){for(var b=0;b<this._width;b++)for(var c=0;c<this._height;c++)this._map[b][c]=ROT.RNG.getUniform()<a?1:0;return this},ROT.Map.Cellular.prototype.setOptions=function(a){for(var b in a)this._options[b]=a[b]},ROT.Map.Cellular.prototype.set=function(a,b,c){this._map[a][b]=c},ROT.Map.Cellular.prototype.create=function(a){for(var b=this._fillMap(0),c=this._options.born,d=this._options.survive,e=0;e<this._height;e++){var f=1,g=0;6==this._options.topology&&(f=2,g=e%2);for(var h=g;h<this._width;h+=f){var i=this._map[h][e],j=this._getNeighbors(h,e);i&&-1!=d.indexOf(j)?b[h][e]=1:i||-1==c.indexOf(j)||(b[h][e]=1),a&&a(h,e,b[h][e])}}this._map=b},ROT.Map.Cellular.prototype._getNeighbors=function(a,b){for(var c=0,d=0;d<this._dirs.length;d++){var e=this._dirs[d],f=a+e[0],g=b+e[1];0>f||f>=this._width||0>f||g>=this._width||(c+=1==this._map[f][g]?1:0)}return c},ROT.Map.Dungeon=function(a,b){ROT.Map.call(this,a,b),this._rooms=[],this._corridors=[]},ROT.Map.Dungeon.extend(ROT.Map),ROT.Map.Dungeon.prototype.getRooms=function(){return this._rooms},ROT.Map.Dungeon.prototype.getCorridors=function(){return this._corridors},ROT.Map.Digger=function(a,b,c){ROT.Map.Dungeon.call(this,a,b),this._options={roomWidth:[3,9],roomHeight:[3,5],corridorLength:[5,10],dugPercentage:.2,timeLimit:1e3};for(var d in c)this._options[d]=c[d];this._features={Room:4,Corridor:4},this._featureAttempts=20,this._walls={},this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)},ROT.Map.Digger.extend(ROT.Map.Dungeon),ROT.Map.Digger.prototype.create=function(a){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;var b=(this._width-2)*(this._height-2);this._firstRoom();var c=Date.now();do{var d=Date.now();if(d-c>this._options.timeLimit)break;var e=this._findWall();if(!e)break;var f=e.split(","),g=parseInt(f[0]),h=parseInt(f[1]),i=this._getDiggingDirection(g,h);if(i){var j=0;do if(j++,this._tryFeature(g,h,i[0],i[1])){this._removeSurroundingWalls(g,h),this._removeSurroundingWalls(g-i[0],h-i[1]);break}while(j<this._featureAttempts);var k=0;for(var l in this._walls)this._walls[l]>1&&k++}}while(this._dug/b<this._options.dugPercentage||k);if(this._addDoors(),a)for(var m=0;m<this._width;m++)for(var n=0;n<this._height;n++)a(m,n,this._map[m][n]);return this._walls={},this._map=null,this},ROT.Map.Digger.prototype._digCallback=function(a,b,c){0==c||2==c?(this._map[a][b]=0,this._dug++):this._walls[a+","+b]=1},ROT.Map.Digger.prototype._isWallCallback=function(a,b){return 0>a||0>b||a>=this._width||b>=this._height?!1:1==this._map[a][b]},ROT.Map.Digger.prototype._canBeDugCallback=function(a,b){return 1>a||1>b||a+1>=this._width||b+1>=this._height?!1:1==this._map[a][b]},ROT.Map.Digger.prototype._priorityWallCallback=function(a,b){this._walls[a+","+b]=2},ROT.Map.Digger.prototype._firstRoom=function(){var a=Math.floor(this._width/2),b=Math.floor(this._height/2),c=ROT.Map.Feature.Room.createRandomCenter(a,b,this._options);this._rooms.push(c),c.create(this._digCallback)},ROT.Map.Digger.prototype._findWall=function(){var a=[],b=[];for(var c in this._walls){var d=this._walls[c];2==d?b.push(c):a.push(c)}var e=b.length?b:a;if(!e.length)return null;var c=e.random();return delete this._walls[c],c},ROT.Map.Digger.prototype._tryFeature=function(a,b,c,d){var e=ROT.RNG.getWeightedValue(this._features);return e=ROT.Map.Feature[e].createRandomAt(a,b,c,d,this._options),e.isValid(this._isWallCallback,this._canBeDugCallback)?(e.create(this._digCallback),e instanceof ROT.Map.Feature.Room&&this._rooms.push(e),e instanceof ROT.Map.Feature.Corridor&&(e.createPriorityWalls(this._priorityWallCallback),this._corridors.push(e)),!0):!1},ROT.Map.Digger.prototype._removeSurroundingWalls=function(a,b){for(var c=ROT.DIRS[4],d=0;d<c.length;d++){var e=c[d],f=a+e[0],g=b+e[1];delete this._walls[f+","+g];var f=a+2*e[0],g=b+2*e[1];delete this._walls[f+","+g]}},ROT.Map.Digger.prototype._getDiggingDirection=function(a,b){for(var c=null,d=ROT.DIRS[4],e=0;e<d.length;e++){var f=d[e],g=a+f[0],h=b+f[1];if(0>g||0>h||g>=this._width||h>=this._width)return null;if(!this._map[g][h]){if(c)return null;c=f}}return c?[-c[0],-c[1]]:null},ROT.Map.Digger.prototype._addDoors=function(){for(var a=this._map,b=function(b,c){return 1==a[b][c]},c=0;c<this._rooms.length;c++){var d=this._rooms[c];d.clearDoors(),d.addDoors(b)}},ROT.Map.Uniform=function(a,b,c){ROT.Map.Dungeon.call(this,a,b),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3};for(var d in c)this._options[d]=c[d];this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)},ROT.Map.Uniform.extend(ROT.Map.Dungeon),ROT.Map.Uniform.prototype.create=function(a){for(var b=Date.now();;){var c=Date.now();if(c-b>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(a)for(var d=0;d<this._width;d++)for(var e=0;e<this._height;e++)a(d,e,this._map[d][e]);return this},ROT.Map.Uniform.prototype._generateRooms=function(){var a=this._width-2,b=this._height-2;do{var c=this._generateRoom();if(this._dug/(a*b)>this._options.roomDugPercentage)break}while(c)},ROT.Map.Uniform.prototype._generateRoom=function(){for(var a=0;a<this._roomAttempts;){a++;var b=ROT.Map.Feature.Room.createRandom(this._width,this._height,this._options);if(b.isValid(this._isWallCallback,this._canBeDugCallback))return b.create(this._digCallback),this._rooms.push(b),b}return null},ROT.Map.Uniform.prototype._generateCorridors=function(){for(var a=0;a<this._corridorAttempts;){a++,this._corridors=[],this._map=this._fillMap(1);for(var b=0;b<this._rooms.length;b++){var c=this._rooms[b];c.clearDoors(),c.create(this._digCallback)}for(this._unconnected=this._rooms.slice().randomize(),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){var d=this._connected.random(),e=this._closestRoom(this._unconnected,d),f=this._closestRoom(this._connected,e),g=this._connectRooms(e,f);if(!g)break;if(!this._unconnected.length)return!0}}return!1},ROT.Map.Uniform.prototype._closestRoom=function(a,b){for(var c=1/0,d=b.getCenter(),e=null,f=0;f<a.length;f++){var g=a[f],h=g.getCenter(),i=h[0]-d[0],j=h[1]-d[1],k=i*i+j*j;c>k&&(c=k,e=g)}return e},ROT.Map.Uniform.prototype._connectRooms=function(a,b){var c=a.getCenter(),d=b.getCenter(),e=d[0]-c[0],f=d[1]-c[1];if(Math.abs(e)<Math.abs(f))var g=f>0?2:0,h=(g+2)%4,i=b.getLeft(),j=b.getRight(),k=0;else var g=e>0?1:3,h=(g+2)%4,i=b.getTop(),j=b.getBottom(),k=1;var l=this._placeInWall(a,g);if(!l)return!1;if(l[k]>=i&&l[k]<=j){var m=l.slice(),n=null;switch(h){case 0:n=b.getTop()-1;break;case 1:n=b.getRight()+1;break;case 2:n=b.getBottom()+1;break;case 3:n=b.getLeft()-1}m[(k+1)%2]=n,this._digLine([l,m])}else if(l[k]<i-1||l[k]>j+1){var o=l[k]-d[k];switch(h){case 0:case 1:var p=0>o?3:1;break;case 2:case 3:var p=0>o?1:3}h=(h+p)%4;var m=this._placeInWall(b,h);if(!m)return!1;var q=[0,0];q[k]=l[k];var r=(k+1)%2;q[r]=m[r],this._digLine([l,q,m])}else{var r=(k+1)%2,m=this._placeInWall(b,h);if(!m)return;var q=Math.round((m[r]+l[r])/2),s=[0,0],t=[0,0];s[k]=l[k],s[r]=q,t[k]=m[k],t[r]=q,this._digLine([l,s,t,m])}a.addDoor(l[0],l[1]),b.addDoor(m[0],m[1]);var k=this._unconnected.indexOf(a);-1!=k&&(this._unconnected.splice(k,1),this._connected.push(a));var k=this._unconnected.indexOf(b);return-1!=k&&(this._unconnected.splice(k,1),this._connected.push(b)),!0},ROT.Map.Uniform.prototype._placeInWall=function(a,b){var c=[0,0],d=[0,0],e=0;switch(b){case 0:d=[1,0],c=[a.getLeft(),a.getTop()-1],e=a.getRight()-a.getLeft()+1;break;case 1:d=[0,1],c=[a.getRight()+1,a.getTop()],e=a.getBottom()-a.getTop()+1;break;case 2:d=[1,0],c=[a.getLeft(),a.getBottom()+1],e=a.getRight()-a.getLeft()+1;break;case 3:d=[0,1],c=[a.getLeft()-1,a.getTop()],e=a.getBottom()-a.getTop()+1}for(var f=[],g=-2,h=0;e>h;h++){var i=c[0]+h*d[0],j=c[1]+h*d[1];f.push(null);var k=1==this._map[i][j];k?g!=h-1&&(f[h]=[i,j]):(g=h,h&&(f[h-1]=null))}for(var h=f.length-1;h>=0;h--)f[h]||f.splice(h,1);return f.length?f.random():null},ROT.Map.Uniform.prototype._digLine=function(a){for(var b=1;b<a.length;b++){var c=a[b-1],d=a[b],e=new ROT.Map.Feature.Corridor(c[0],c[1],d[0],d[1]);e.create(this._digCallback),this._corridors.push(e)}},ROT.Map.Uniform.prototype._digCallback=function(a,b,c){this._map[a][b]=c,0==c&&this._dug++},ROT.Map.Uniform.prototype._isWallCallback=function(a,b){return 0>a||0>b||a>=this._width||b>=this._height?!1:1==this._map[a][b]},ROT.Map.Uniform.prototype._canBeDugCallback=function(a,b){return 1>a||1>b||a+1>=this._width||b+1>=this._height?!1:1==this._map[a][b]},ROT.Map.Rogue=function(a,b,c){ROT.Map.call(this,a,b),this._options={cellWidth:3,cellHeight:3};for(var d in c)this._options[d]=c[d];this._options.hasOwnProperty("roomWidth")||(this._options.roomWidth=this._calculateRoomSize(a,this._options.cellWidth)),this._options.hasOwnProperty.roomHeight||(this._options.roomHeight=this._calculateRoomSize(b,this._options.cellHeight))},ROT.Map.Rogue.extend(ROT.Map),ROT.Map.Rogue.prototype.create=function(a){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),a)for(var b=0;b<this._width;b++)for(var c=0;c<this._height;c++)a(b,c,this.map[b][c]);return this},ROT.Map.Rogue.prototype._getRandomInt=function(a,b){return Math.floor(ROT.RNG.getUniform()*(b-a+1))+a},ROT.Map.Rogue.prototype._calculateRoomSize=function(a,b){var c=Math.floor(a/b*.8),d=Math.floor(a/b*.25);
return 2>d&&(d=2),2>c&&(c=2),[d,c]},ROT.Map.Rogue.prototype._initRooms=function(){for(var a=0;a<this._options.cellWidth;a++){this.rooms.push([]);for(var b=0;b<this._options.cellHeight;b++)this.rooms[a].push({x:0,y:0,width:0,height:0,connections:[],cellx:a,celly:b})}},ROT.Map.Rogue.prototype._connectRooms=function(){var a,b,c,d,e,f=this._getRandomInt(0,this._options.cellWidth-1),g=this._getRandomInt(0,this._options.cellHeight-1),h=!1;do{var i=[0,2,4,6];i=i.randomize();do if(h=!1,a=i.pop(),b=f+ROT.DIRS[8][a][0],c=g+ROT.DIRS[8][a][1],!(0>b||b>=this._options.cellWidth||0>c||c>=this._options.cellHeight)){if(d=this.rooms[f][g],d.connections.length>0&&d.connections[0][0]==b&&d.connections[0][1]==c)break;e=this.rooms[b][c],0==e.connections.length&&(e.connections.push([f,g]),this.connectedCells.push([b,c]),f=b,g=c,h=!0)}while(i.length>0&&0==h)}while(i.length>0)},ROT.Map.Rogue.prototype._connectUnconnectedRooms=function(){var a=this._options.cellWidth,b=this._options.cellHeight;this.connectedCells=this.connectedCells.randomize();for(var c,d,e,f=0;f<this._options.cellWidth;f++)for(var g=0;g<this._options.cellHeight;g++)if(c=this.rooms[f][g],0==c.connections.length){var h=[0,2,4,6];h=h.randomize();var e=!1;do{var i=h.pop(),j=f+ROT.DIRS[8][i][0],k=g+ROT.DIRS[8][i][1];if(!(0>j||j>=a||0>k||k>=b)){if(d=this.rooms[j][k],e=!0,0==d.connections.length)break;for(var l=0;l<d.connections.length;l++)if(d.connections[l][0]==f&&d.connections[l][1]==g){e=!1;break}if(e)break}}while(h.length);e?c.connections.push([d.cellx,d.celly]):console.log("-- Unable to connect room.")}},ROT.Map.Rogue.prototype._createRandomRoomConnections=function(){},ROT.Map.Rogue.prototype._createRooms=function(){for(var a,b,c,d,e,f=this._width,g=this._height,h=this._options.cellWidth,i=this._options.cellHeight,j=Math.floor(this._width/h),k=Math.floor(this._height/i),l=this._options.roomWidth,m=this._options.roomHeight,n=0;h>n;n++)for(var o=0;i>o;o++){if(c=j*n,d=k*o,0==c&&(c=1),0==d&&(d=1),a=this._getRandomInt(l[0],l[1]),b=this._getRandomInt(m[0],m[1]),o>0)for(e=this.rooms[n][o-1];d-(e.y+e.height)<3;)d++;if(n>0)for(e=this.rooms[n-1][o];c-(e.x+e.width)<3;)c++;for(var p=Math.round(this._getRandomInt(0,j-a)/2),q=Math.round(this._getRandomInt(0,k-b)/2);c+p+a>=f;)p?p--:a--;for(;d+q+b>=g;)q?q--:b--;c+=p,d+=q,this.rooms[n][o].x=c,this.rooms[n][o].y=d,this.rooms[n][o].width=a,this.rooms[n][o].height=b;for(var r=c;c+a>r;r++)for(var s=d;d+b>s;s++)this.map[r][s]=0}},ROT.Map.Rogue.prototype._getWallPosition=function(a,b){var c,d,e;return 1==b||3==b?(c=this._getRandomInt(a.x+1,a.x+a.width-2),1==b?(d=a.y-2,e=d+1):(d=a.y+a.height+1,e=d-1),this.map[c][e]=0):(2==b||4==b)&&(d=this._getRandomInt(a.y+1,a.y+a.height-2),2==b?(c=a.x+a.width+1,e=c-1):(c=a.x-2,e=c+1),this.map[e][d]=0),[c,d]},ROT.Map.Rogue.prototype._drawCorridore=function(a,b){var c,d,e,f,g=b[0]-a[0],h=b[1]-a[1],i=a[0],j=a[1],k=[],l=Math.abs(g),m=Math.abs(h),n=ROT.RNG.getUniform(),o=n,p=1-n;for(d=g>0?2:6,e=h>0?4:0,m>l?(c=Math.ceil(m*o),k.push([e,c]),k.push([d,l]),c=Math.floor(m*p),k.push([e,c])):(c=Math.ceil(l*o),k.push([d,c]),k.push([e,m]),c=Math.floor(l*p),k.push([d,c])),this.map[i][j]=0;k.length>0;)for(f=k.pop();f[1]>0;)i+=ROT.DIRS[8][f[0]][0],j+=ROT.DIRS[8][f[0]][1],this.map[i][j]=0,f[1]=f[1]-1},ROT.Map.Rogue.prototype._createCorridors=function(){for(var a,b,c,d,e,f=this._options.cellWidth,g=this._options.cellHeight,h=0;f>h;h++)for(var i=0;g>i;i++){a=this.rooms[h][i];for(var j=0;j<a.connections.length;j++)b=a.connections[j],c=this.rooms[b[0]][b[1]],c.cellx>a.cellx?(d=2,e=4):c.cellx<a.cellx?(d=4,e=2):c.celly>a.celly?(d=3,e=1):c.celly<a.celly&&(d=1,e=3),this._drawCorridore(this._getWallPosition(a,d),this._getWallPosition(c,e))}},ROT.Map.Feature=function(){},ROT.Map.Feature.prototype.isValid=function(){},ROT.Map.Feature.prototype.create=function(){},ROT.Map.Feature.prototype.debug=function(){},ROT.Map.Feature.createRandomAt=function(){},ROT.Map.Feature.Room=function(a,b,c,d,e,f){this._x1=a,this._y1=b,this._x2=c,this._y2=d,this._doors={},arguments.length>4&&this.addDoor(e,f)},ROT.Map.Feature.Room.extend(ROT.Map.Feature),ROT.Map.Feature.Room.createRandomAt=function(a,b,c,d,e){var f=e.roomWidth[0],g=e.roomWidth[1],h=f+Math.floor(ROT.RNG.getUniform()*(g-f+1)),f=e.roomHeight[0],g=e.roomHeight[1],i=f+Math.floor(ROT.RNG.getUniform()*(g-f+1));if(1==c){var j=b-Math.floor(ROT.RNG.getUniform()*i);return new this(a+1,j,a+h,j+i-1,a,b)}if(-1==c){var j=b-Math.floor(ROT.RNG.getUniform()*i);return new this(a-h,j,a-1,j+i-1,a,b)}if(1==d){var k=a-Math.floor(ROT.RNG.getUniform()*h);return new this(k,b+1,k+h-1,b+i,a,b)}if(-1==d){var k=a-Math.floor(ROT.RNG.getUniform()*h);return new this(k,b-i,k+h-1,b-1,a,b)}},ROT.Map.Feature.Room.createRandomCenter=function(a,b,c){var d=c.roomWidth[0],e=c.roomWidth[1],f=d+Math.floor(ROT.RNG.getUniform()*(e-d+1)),d=c.roomHeight[0],e=c.roomHeight[1],g=d+Math.floor(ROT.RNG.getUniform()*(e-d+1)),h=a-Math.floor(ROT.RNG.getUniform()*f),i=b-Math.floor(ROT.RNG.getUniform()*g),j=h+f-1,k=i+g-1;return new this(h,i,j,k)},ROT.Map.Feature.Room.createRandom=function(a,b,c){var d=c.roomWidth[0],e=c.roomWidth[1],f=d+Math.floor(ROT.RNG.getUniform()*(e-d+1)),d=c.roomHeight[0],e=c.roomHeight[1],g=d+Math.floor(ROT.RNG.getUniform()*(e-d+1)),h=a-f-1,i=b-g-1,j=1+Math.floor(ROT.RNG.getUniform()*h),k=1+Math.floor(ROT.RNG.getUniform()*i),l=j+f-1,m=k+g-1;return new this(j,k,l,m)},ROT.Map.Feature.Room.prototype.addDoor=function(a,b){return this._doors[a+","+b]=1,this},ROT.Map.Feature.Room.prototype.getDoors=function(a){for(var b in this._doors){var c=b.split(",");a(parseInt(c[0]),parseInt(c[1]))}return this},ROT.Map.Feature.Room.prototype.clearDoors=function(){return this._doors={},this},ROT.Map.Feature.Room.prototype.addDoors=function(a){for(var b=this._x1-1,c=this._x2+1,d=this._y1-1,e=this._y2+1,f=b;c>=f;f++)for(var g=d;e>=g;g++)(f==b||f==c||g==d||g==e)&&(a(f,g)||this.addDoor(f,g));return this},ROT.Map.Feature.Room.prototype.debug=function(){console.log("room",this._x1,this._y1,this._x2,this._y2)},ROT.Map.Feature.Room.prototype.isValid=function(a,b){for(var c=this._x1-1,d=this._x2+1,e=this._y1-1,f=this._y2+1,g=c;d>=g;g++)for(var h=e;f>=h;h++)if(g==c||g==d||h==e||h==f){if(!a(g,h))return!1}else if(!b(g,h))return!1;return!0},ROT.Map.Feature.Room.prototype.create=function(a){for(var b=this._x1-1,c=this._x2+1,d=this._y1-1,e=this._y2+1,f=0,g=b;c>=g;g++)for(var h=d;e>=h;h++)f=g+","+h in this._doors?2:g==b||g==c||h==d||h==e?1:0,a(g,h,f)},ROT.Map.Feature.Room.prototype.getCenter=function(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]},ROT.Map.Feature.Room.prototype.getLeft=function(){return this._x1},ROT.Map.Feature.Room.prototype.getRight=function(){return this._x2},ROT.Map.Feature.Room.prototype.getTop=function(){return this._y1},ROT.Map.Feature.Room.prototype.getBottom=function(){return this._y2},ROT.Map.Feature.Corridor=function(a,b,c,d){this._startX=a,this._startY=b,this._endX=c,this._endY=d,this._endsWithAWall=!0},ROT.Map.Feature.Corridor.extend(ROT.Map.Feature),ROT.Map.Feature.Corridor.createRandomAt=function(a,b,c,d,e){var f=e.corridorLength[0],g=e.corridorLength[1],h=f+Math.floor(ROT.RNG.getUniform()*(g-f+1));return new this(a,b,a+c*h,b+d*h)},ROT.Map.Feature.Corridor.prototype.debug=function(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)},ROT.Map.Feature.Corridor.prototype.isValid=function(a,b){var c=this._startX,d=this._startY,e=this._endX-c,f=this._endY-d,g=1+Math.max(Math.abs(e),Math.abs(f));e&&(e/=Math.abs(e)),f&&(f/=Math.abs(f));for(var h=f,i=-e,j=!0,k=0;g>k;k++){var l=c+k*e,m=d+k*f;if(b(l,m)||(j=!1),a(l+h,m+i)||(j=!1),a(l-h,m-i)||(j=!1),!j){g=k,this._endX=l-e,this._endY=m-f;break}}if(0==g)return!1;if(1==g&&a(this._endX+e,this._endY+f))return!1;var n=!a(this._endX+e+h,this._endY+f+i),o=!a(this._endX+e-h,this._endY+f-i);return this._endsWithAWall=a(this._endX+e,this._endY+f),(n||o)&&this._endsWithAWall?!1:!0},ROT.Map.Feature.Corridor.prototype.create=function(a){var b=this._startX,c=this._startY,d=this._endX-b,e=this._endY-c,f=1+Math.max(Math.abs(d),Math.abs(e));d&&(d/=Math.abs(d)),e&&(e/=Math.abs(e));for(var g=0;f>g;g++){var h=b+g*d,i=c+g*e;a(h,i,0)}return!0},ROT.Map.Feature.Corridor.prototype.createPriorityWalls=function(a){if(this._endsWithAWall){var b=this._startX,c=this._startY,d=this._endX-b,e=this._endY-c;d&&(d/=Math.abs(d)),e&&(e/=Math.abs(e));var f=e,g=-d;a(this._endX+d,this._endY+e),a(this._endX+f,this._endY+g),a(this._endX-f,this._endY-g)}},ROT.Noise=function(){},ROT.Noise.prototype.get=function(){},ROT.Noise.Simplex=function(a){ROT.Noise.call(this),this._F2=.5*(Math.sqrt(3)-1),this._G2=(3-Math.sqrt(3))/6,this._gradients=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];for(var b=[],c=a||256,d=0;c>d;d++)b.push(d);b=b.randomize(),this._perms=[],this._indexes=[];for(var d=0;2*c>d;d++)this._perms.push(b[d%c]),this._indexes.push(this._perms[d]%this._gradients.length)},ROT.Noise.Simplex.extend(ROT.Noise),ROT.Noise.Simplex.prototype.get=function(a,b){var c,d,e,f=this._perms,g=this._indexes,h=f.length/2,i=this._G2,j=0,k=0,l=0,m=(a+b)*this._F2,n=Math.floor(a+m),o=Math.floor(b+m),p=(n+o)*i,q=n-p,r=o-p,s=a-q,t=b-r;s>t?(d=1,e=0):(d=0,e=1);var u=s-d+i,v=t-e+i,w=s-1+2*i,x=t-1+2*i,y=n.mod(h),z=o.mod(h),A=.5-s*s-t*t;if(A>=0){A*=A,c=g[y+f[z]];var B=this._gradients[c];j=A*A*(B[0]*s+B[1]*t)}var C=.5-u*u-v*v;if(C>=0){C*=C,c=g[y+d+f[z+e]];var B=this._gradients[c];k=C*C*(B[0]*u+B[1]*v)}var D=.5-w*w-x*x;if(D>=0){D*=D,c=g[y+1+f[z+1]];var B=this._gradients[c];l=D*D*(B[0]*w+B[1]*x)}return 70*(j+k+l)},ROT.FOV=function(a,b){this._lightPasses=a,this._options={topology:8};for(var c in b)this._options[c]=b[c]},ROT.FOV.prototype.compute=function(){},ROT.FOV.prototype._getCircle=function(a,b,c){var d,e,f,g=[];switch(this._options.topology){case 4:e=1,f=[0,1],d=[ROT.DIRS[8][7],ROT.DIRS[8][1],ROT.DIRS[8][3],ROT.DIRS[8][5]];break;case 6:d=ROT.DIRS[6],e=1,f=[-1,1];break;case 8:d=ROT.DIRS[4],e=2,f=[-1,1]}for(var h=a+f[0]*c,i=b+f[1]*c,j=0;j<d.length;j++)for(var k=0;c*e>k;k++)g.push([h,i]),h+=d[j][0],i+=d[j][1];return g},ROT.FOV.DiscreteShadowcasting=function(a,b){ROT.FOV.call(this,a,b)},ROT.FOV.DiscreteShadowcasting.extend(ROT.FOV),ROT.FOV.DiscreteShadowcasting.prototype.compute=function(a,b,c,d){this._coords,this._map;if(d(a,b,0),this._lightPasses(a,b))for(var e,f,g,h,i,j=[],k=1;c>=k;k++)for(var l=this._getCircle(a,b,k),m=360/l.length,n=0;n<l.length;n++)if(g=l[n][0],h=l[n][1],e=m*(n-.5),f=e+m,i=!this._lightPasses(g,h),this._visibleCoords(Math.floor(e),Math.ceil(f),i,j)&&d(g,h,k,1),2==j.length&&0==j[0]&&360==j[1])return},ROT.FOV.DiscreteShadowcasting.prototype._visibleCoords=function(a,b,c,d){if(0>a){var e=arguments.callee(0,b,c,d),f=arguments.callee(360+a,360,c,d);return e||f}for(var g=0;g<d.length&&d[g]<a;)g++;if(g==d.length)return c&&d.push(a,b),!0;var h=0;if(g%2){for(;g<d.length&&d[g]<b;)g++,h++;return 0==h?!1:(c&&(h%2?d.splice(g-h,h,b):d.splice(g-h,h)),!0)}for(;g<d.length&&d[g]<b;)g++,h++;return a==d[g-h]&&1==h?!1:(c&&(h%2?d.splice(g-h,h,a):d.splice(g-h,h,a,b)),!0)},ROT.FOV.PreciseShadowcasting=function(a,b){ROT.FOV.call(this,a,b)},ROT.FOV.PreciseShadowcasting.extend(ROT.FOV),ROT.FOV.PreciseShadowcasting.prototype.compute=function(a,b,c,d){if(d(a,b,0,1),this._lightPasses(a,b))for(var e,f,g,h,i,j,k=[],l=1;c>=l;l++)for(var m=this._getCircle(a,b,l),n=m.length,o=0;n>o;o++)if(e=m[o][0],f=m[o][1],h=[o?2*o-1:2*n-1,2*n],i=[2*o+1,2*n],g=!this._lightPasses(e,f),j=this._checkVisibility(h,i,g,k),j&&d(e,f,l,j),2==k.length&&0==k[0][0]&&k[1][0]==k[1][1])return},ROT.FOV.PreciseShadowcasting.prototype._checkVisibility=function(a,b,c,d){if(a[0]>b[0]){var e=this._checkVisibility(a,[a[1],a[1]],c,d),f=this._checkVisibility([0,1],b,c,d);return(e+f)/2}for(var g=0,h=!1;g<d.length;){var i=d[g],j=i[0]*a[1]-a[0]*i[1];if(j>=0){0!=j||g%2||(h=!0);break}g++}for(var k=d.length,l=!1;k--;){var i=d[k],j=b[0]*i[1]-i[0]*b[1];if(j>=0){0==j&&k%2&&(l=!0);break}}var m=!0;if(g==k&&(h||l)?m=!1:h&&l&&g+1==k&&k%2?m=!1:g>k&&g%2&&(m=!1),!m)return 0;var n,o,p=k-g+1;if(p%2)if(g%2){var o=d[g];n=(b[0]*o[1]-o[0]*b[1])/(o[1]*b[1]),c&&d.splice(g,p,b)}else{var o=d[k];n=(o[0]*a[1]-a[0]*o[1])/(a[1]*o[1]),c&&d.splice(g,p,a)}else{if(!(g%2))return c&&d.splice(g,p,a,b),1;var q=d[g],r=d[k];n=(r[0]*q[1]-q[0]*r[1])/(q[1]*r[1]),c&&d.splice(g,p)}var s=(b[0]*a[1]-a[0]*b[1])/(a[1]*b[1]);return n/s},ROT.FOV.RecursiveShadowcasting=function(a,b){ROT.FOV.call(this,a,b)},ROT.FOV.RecursiveShadowcasting.extend(ROT.FOV),ROT.FOV.RecursiveShadowcasting.OCTANTS=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]],ROT.FOV.RecursiveShadowcasting.prototype.compute=function(a,b,c,d){d(a,b,0,!0);for(var e=0;e<ROT.FOV.RecursiveShadowcasting.OCTANTS.length;e++)this._renderOctant(a,b,ROT.FOV.RecursiveShadowcasting.OCTANTS[e],c,d)},ROT.FOV.RecursiveShadowcasting.prototype.compute180=function(a,b,c,d,e){e(a,b,0,!0);var f=(d-1+8)%8,g=(d-2+8)%8,h=(d+1+8)%8;this._renderOctant(a,b,ROT.FOV.RecursiveShadowcasting.OCTANTS[g],c,e),this._renderOctant(a,b,ROT.FOV.RecursiveShadowcasting.OCTANTS[f],c,e),this._renderOctant(a,b,ROT.FOV.RecursiveShadowcasting.OCTANTS[d],c,e),this._renderOctant(a,b,ROT.FOV.RecursiveShadowcasting.OCTANTS[h],c,e)},ROT.FOV.RecursiveShadowcasting.prototype.compute90=function(a,b,c,d,e){e(a,b,0,!0);var f=(d-1+8)%8;this._renderOctant(a,b,ROT.FOV.RecursiveShadowcasting.OCTANTS[d],c,e),this._renderOctant(a,b,ROT.FOV.RecursiveShadowcasting.OCTANTS[f],c,e)},ROT.FOV.RecursiveShadowcasting.prototype._renderOctant=function(a,b,c,d,e){this._castVisibility(a,b,1,1,0,d+1,c[0],c[1],c[2],c[3],e)},ROT.FOV.RecursiveShadowcasting.prototype._castVisibility=function(a,b,c,d,e,f,g,h,i,j,k){if(!(e>d))for(var l=c;f>=l;l++){for(var m=-l-1,n=-l,o=!1,p=0;0>=m;){m+=1;var q=a+m*g+n*h,r=b+m*i+n*j,s=(m-.5)/(n+.5),t=(m+.5)/(n-.5);if(!(t>d)){if(e>s)break;if(f*f>m*m+n*n&&k(q,r,l,!0),o){if(!this._lightPasses(q,r)){p=t;continue}o=!1,d=p}else!this._lightPasses(q,r)&&f>l&&(o=!0,this._castVisibility(a,b,l+1,d,s,f,g,h,i,j,k),p=t)}}if(o)break}},ROT.Color={fromString:function(a){var b,c;if(a in this._cache)b=this._cache[a];else{if("#"==a.charAt(0)){var d=a.match(/[0-9a-f]/gi).map(function(a){return parseInt(a,16)});if(3==d.length)b=d.map(function(a){return 17*a});else{for(var e=0;3>e;e++)d[e+1]+=16*d[e],d.splice(e,1);b=d}}else b=(c=a.match(/rgb\(([0-9, ]+)\)/i))?c[1].split(/\s*,\s*/).map(function(a){return parseInt(a)}):[0,0,0];this._cache[a]=b}return b.slice()},add:function(a){for(var b=a.slice(),c=0;3>c;c++)for(var d=1;d<arguments.length;d++)b[c]+=arguments[d][c];return b},add_:function(a){for(var b=0;3>b;b++)for(var c=1;c<arguments.length;c++)a[b]+=arguments[c][b];return a},multiply:function(a){for(var b=a.slice(),c=0;3>c;c++){for(var d=1;d<arguments.length;d++)b[c]*=arguments[d][c]/255;b[c]=Math.round(b[c])}return b},multiply_:function(a){for(var b=0;3>b;b++){for(var c=1;c<arguments.length;c++)a[b]*=arguments[c][b]/255;a[b]=Math.round(a[b])}return a},interpolate:function(a,b,c){arguments.length<3&&(c=.5);for(var d=a.slice(),e=0;3>e;e++)d[e]=Math.round(d[e]+c*(b[e]-a[e]));return d},interpolateHSL:function(a,b,c){arguments.length<3&&(c=.5);for(var d=this.rgb2hsl(a),e=this.rgb2hsl(b),f=0;3>f;f++)d[f]+=c*(e[f]-d[f]);return this.hsl2rgb(d)},randomize:function(a,b){b instanceof Array||(b=ROT.RNG.getNormal(0,b));for(var c=a.slice(),d=0;3>d;d++)c[d]+=b instanceof Array?Math.round(ROT.RNG.getNormal(0,b[d])):b;return c},rgb2hsl:function(a){var b,c,d=a[0]/255,e=a[1]/255,f=a[2]/255,g=Math.max(d,e,f),h=Math.min(d,e,f),i=(g+h)/2;if(g==h)b=c=0;else{var j=g-h;switch(c=i>.5?j/(2-g-h):j/(g+h),g){case d:b=(e-f)/j+(f>e?6:0);break;case e:b=(f-d)/j+2;break;case f:b=(d-e)/j+4}b/=6}return[b,c,i]},hsl2rgb:function(a){function b(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a}var c=a[2];if(0==a[1])return c=Math.round(255*c),[c,c,c];var d=a[1],e=.5>c?c*(1+d):c+d-c*d,f=2*c-e,g=b(f,e,a[0]+1/3),h=b(f,e,a[0]),i=b(f,e,a[0]-1/3);return[Math.round(255*g),Math.round(255*h),Math.round(255*i)]},toRGB:function(a){return"rgb("+this._clamp(a[0])+","+this._clamp(a[1])+","+this._clamp(a[2])+")"},toHex:function(a){for(var b=[],c=0;3>c;c++)b.push(this._clamp(a[c]).toString(16).lpad("0",2));return"#"+b.join("")},_clamp:function(a){return 0>a?0:a>255?255:a},_cache:{black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]}},ROT.Lighting=function(a,b){this._reflectivityCallback=a,this._options={passes:1,emissionThreshold:100,range:10},this._fov=null,this._lights={},this._reflectivityCache={},this._fovCache={},this.setOptions(b)},ROT.Lighting.prototype.setOptions=function(a){for(var b in a)this._options[b]=a[b];return a.range&&this.reset(),this},ROT.Lighting.prototype.setFOV=function(a){return this._fov=a,this._fovCache={},this},ROT.Lighting.prototype.setLight=function(a,b,c){var d=a+","+b;return c?this._lights[d]="string"==typeof c?ROT.Color.fromString(c):c:delete this._lights[d],this},ROT.Lighting.prototype.reset=function(){return this._reflectivityCache={},this._fovCache={},this},ROT.Lighting.prototype.compute=function(a){var b={},c={},d={};for(var e in this._lights){var f=this._lights[e];e in c||(c[e]=[0,0,0]),ROT.Color.add_(c[e],f)}for(var g=0;g<this._options.passes;g++)this._emitLight(c,d,b),g+1!=this._options.passes&&(c=this._computeEmitters(d,b));for(var h in d){var i=h.split(","),j=parseInt(i[0]),k=parseInt(i[1]);a(j,k,d[h])}return this},ROT.Lighting.prototype._emitLight=function(a,b,c){for(var d in a){var e=d.split(","),f=parseInt(e[0]),g=parseInt(e[1]);this._emitLightFromCell(f,g,a[d],b),c[d]=1}return this},ROT.Lighting.prototype._computeEmitters=function(a,b){var c={};for(var d in a)if(!(d in b)){var e=a[d];if(d in this._reflectivityCache)var f=this._reflectivityCache[d];else{var g=d.split(","),h=parseInt(g[0]),i=parseInt(g[1]),f=this._reflectivityCallback(h,i);this._reflectivityCache[d]=f}if(0!=f){for(var j=[],k=0,l=0;3>l;l++){var m=Math.round(e[l]*f);j[l]=m,k+=m}k>this._options.emissionThreshold&&(c[d]=j)}}return c},ROT.Lighting.prototype._emitLightFromCell=function(a,b,c,d){var e=a+","+b;if(e in this._fovCache)var f=this._fovCache[e];else var f=this._updateFOV(a,b);for(var g in f){var h=f[g];if(g in d)var i=d[g];else{var i=[0,0,0];d[g]=i}for(var j=0;3>j;j++)i[j]+=Math.round(c[j]*h)}return this},ROT.Lighting.prototype._updateFOV=function(a,b){var c=a+","+b,d={};this._fovCache[c]=d;var e=this._options.range,f=function(a,b,c,f){var g=a+","+b,h=f*(1-c/e);0!=h&&(d[g]=h)};return this._fov.compute(a,b,e,f.bind(this)),d},ROT.Path=function(a,b,c,d){this._toX=a,this._toY=b,this._fromX=null,this._fromY=null,this._passableCallback=c,this._options={topology:8};for(var e in d)this._options[e]=d[e];this._dirs=ROT.DIRS[this._options.topology],8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])},ROT.Path.prototype.compute=function(){},ROT.Path.prototype._getNeighbors=function(a,b){for(var c=[],d=0;d<this._dirs.length;d++){var e=this._dirs[d],f=a+e[0],g=b+e[1];this._passableCallback(f,g)&&c.push([f,g])}return c},ROT.Path.Dijkstra=function(a,b,c,d){ROT.Path.call(this,a,b,c,d),this._computed={},this._todo=[],this._add(a,b,null)},ROT.Path.Dijkstra.extend(ROT.Path),ROT.Path.Dijkstra.prototype.compute=function(a,b,c){var d=a+","+b;if(d in this._computed||this._compute(a,b),d in this._computed)for(var e=this._computed[d];e;)c(e.x,e.y),e=e.prev},ROT.Path.Dijkstra.prototype._compute=function(a,b){for(;this._todo.length;){var c=this._todo.shift();if(c.x==a&&c.y==b)return;for(var d=this._getNeighbors(c.x,c.y),e=0;e<d.length;e++){var f=d[e],g=f[0],h=f[1],i=g+","+h;i in this._computed||this._add(g,h,c)}}},ROT.Path.Dijkstra.prototype._add=function(a,b,c){var d={x:a,y:b,prev:c};this._computed[a+","+b]=d,this._todo.push(d)},ROT.Path.AStar=function(a,b,c,d){ROT.Path.call(this,a,b,c,d),this._todo=[],this._done={},this._fromX=null,this._fromY=null},ROT.Path.AStar.extend(ROT.Path),ROT.Path.AStar.prototype.compute=function(a,b,c){for(this._todo=[],this._done={},this._fromX=a,this._fromY=b,this._add(this._toX,this._toY,null);this._todo.length;){var d=this._todo.shift();if(d.x==a&&d.y==b)break;for(var e=this._getNeighbors(d.x,d.y),f=0;f<e.length;f++){var g=e[f],h=g[0],i=g[1],j=h+","+i;j in this._done||this._add(h,i,d)}}var d=this._done[a+","+b];if(d)for(;d;)c(d.x,d.y),d=d.prev},ROT.Path.AStar.prototype._add=function(a,b,c){var d={x:a,y:b,prev:c,g:c?c.g+1:0,h:this._distance(a,b)};this._done[a+","+b]=d;for(var e=d.g+d.h,f=0;f<this._todo.length;f++){var g=this._todo[f];if(e<g.g+g.h)return void this._todo.splice(f,0,d)}this._todo.push(d)},ROT.Path.AStar.prototype._distance=function(a,b){switch(this._options.topology){case 4:return Math.abs(a-this._fromX)+Math.abs(b-this._fromY);case 6:var c=Math.abs(a-this._fromX),d=Math.abs(b-this._fromY);return d+Math.max(0,(c-d)/2);case 8:return Math.max(Math.abs(a-this._fromX),Math.abs(b-this._fromY))}}},{}],24:[function(a,b){"use strict";function c(a){console.log("NEW MAP"),a.progress=a.progress||function(){};var b=[],c=a.height,e=new o.Map.Digger(a.width,c,{roomHeight:a.roomHeight,roomWidth:a.roomWidth});e.create(function(c,d,e){b.push(e),a.progress(c,d,e)});var f,g,h;f=[],g=[],h=[],d(b,h,g,f,c),this.tiles=h,this.grounds=g,this.walls=f,this.data=b,this.map=e}function d(a,b,c,d,o){var p,q,r,s;for(p=0;p<a.length;p++)q=a[p],s={x:Math.floor(p/o),y:p%o},0===q?(s.type="ground",c.push(s),b.push(nuclear.entity("tile").create(s))):1===q&&(f(a,p,o)?(s.type="upperRight",d.push(s),b.push(nuclear.entity("tile").create(s)),b.push(nuclear.entity("tile").create({x:s.x,y:s.y,type:s.type+"_top"})),a[p]=2):g(a,p,o)?(s.type="upperLeft",d.push(s),b.push(nuclear.entity("tile").create(s)),b.push(nuclear.entity("tile").create({x:s.x,y:s.y,type:s.type+"_top"})),a[p]=2):h(a,p,o)?(s.type="downRight",d.push(s),b.push(nuclear.entity("tile").create(s)),b.push(nuclear.entity("tile").create({x:s.x,y:s.y,type:s.type+"_top"})),a[p]=2):i(a,p,o)?(s.type="downLeft",d.push(s),b.push(nuclear.entity("tile").create(s)),b.push(nuclear.entity("tile").create({x:s.x,y:s.y,type:s.type+"_top"})),a[p]=2):j(a,p,o)?(s.type="upperExternalLeft",d.push(s),b.push(nuclear.entity("tile").create(s)),a[p]=2):k(a,p,o)?(s.type="upperExternalRight",d.push(s),b.push(nuclear.entity("tile").create(s)),a[p]=2):m(a,p,o)?(s.type="downExternalLeft",d.push(s),b.push(nuclear.entity("tile").create(s)),a[p]=2):l(a,p,o)?(s.type="downExternalRight",d.push(s),b.push(nuclear.entity("tile").create(s)),a[p]=2):n(a,p,o)?(s.type="doubleSides",d.push(s),b.push(nuclear.entity("tile").create(s)),a[p]=2):(r=e(a,p,o),r&&(s.type=r,d.push(s),b.push(nuclear.entity("tile").create(s)),b.push(nuclear.entity("tile").create({x:s.x,y:s.y,type:s.type+"_top"})),a[p]=2)))}function e(a,b,c){return 0===a[b+1]?"up":0===a[b-1]?"down":0===a[b+c]?"right":0===a[b-c]?"left":!1}function f(a,b,c){return 0!==a[b+1]&&0===a[b-1]&&0!==a[b+c]&&0===a[b-c]}function g(a,b,c){return 0===a[b+1]&&0!==a[b-1]&&0!==a[b+c]&&0===a[b-c]}function h(a,b,c){return 0!==a[b+1]&&0===a[b-1]&&0===a[b+c]&&0!==a[b-c]}function i(a,b,c){return 0===a[b+1]&&0!==a[b-1]&&0===a[b+c]&&0!==a[b-c]}function j(a,b,c){return 0!==a[b+1]&&0!==a[b+c]&&0!==a[b-c]&&0===a[b+c+1]}function k(a,b,c){return 0!==a[b+1]&&0!==a[b+c]&&0!==a[b-c]&&0===a[b-c+1]}function l(a,b,c){return 0!==a[b+1]&&0!==a[b-1]&&0!==a[b+c]&&0!==a[b-c]&&0===a[b-c-1]}function m(a,b,c){return 0!==a[b+1]&&0!==a[b-1]&&0!==a[b+c]&&0!==a[b-c]&&0===a[b+c-1]}function n(a,b,c){return 0!==a[b+1]&&0===a[b+c]&&0===a[b-c]}var o;a("./lib/rot"),o=window.ROT,b.exports=c},{"./lib/rot":23}],25:[function(a,b){"use strict";function c(a,b,c,e,f){this.config=f,this.position=b,this.width=c,this.height=e,this.id=a,this.slots=d(this,f.slots)}function d(a,b){var c,d,e,f;for(f=[],c=0;c<b.length;c++)d=b[c],e={},e.position={x:a.position.x+Math.round(d.position.x*a.width/100),y:a.position.y+Math.round(d.position.y*a.height/100)},e.bundle=a.config.bundle,e.type=d.type,e.template=a.id,f.push(nuclear.entity("slot from roguemap").create(e));return f}b.exports=c},{}],26:[function(a,b){"use strict";function c(a,b){this.x=a,this.y=b}b.exports=c},{}],27:[function(a,b){"use strict";var c;c=a("./components/position-component"),b.exports=nuclear.module("game.transform",[]).component("position",function(a,b,d){return new c(b,d)})},{"./components/position-component":26}]},{},[5]);